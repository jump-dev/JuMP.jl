<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Implementing a constraint bridge · JuMP</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-44252521-1"></script><script>  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-44252521-1', {'page_path': location.pathname + location.search + location.hash});
</script><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script><link href="../../../assets/extra_styles.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../"><img class="docs-light-only" src="../../../assets/logo.svg" alt="JuMP logo"/><img class="docs-dark-only" src="../../../assets/logo-dark.svg" alt="JuMP logo"/></a><form class="docs-search" action="../../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><input class="collapse-toggle" id="menuitem-1" type="checkbox"/><label class="tocitem" for="menuitem-1"><span class="docs-label">Introduction</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../">Introduction</a></li><li><a class="tocitem" href="../../../should_i_use/">Should I use JuMP?</a></li><li><a class="tocitem" href="../../../installation/">Installation Guide</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox"/><label class="tocitem" for="menuitem-2"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-2-1" type="checkbox"/><label class="tocitem" for="menuitem-2-1"><span class="docs-label">Getting started</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../tutorials/getting_started/introduction/">Introduction</a></li><li><a class="tocitem" href="../../../tutorials/getting_started/getting_started_with_julia/">Getting started with Julia</a></li><li><a class="tocitem" href="../../../tutorials/getting_started/getting_started_with_JuMP/">Getting started with JuMP</a></li><li><a class="tocitem" href="../../../tutorials/getting_started/getting_started_with_sets_and_indexing/">Getting started with sets and indexing</a></li><li><a class="tocitem" href="../../../tutorials/getting_started/getting_started_with_data_and_plotting/">Getting started with data and plotting</a></li><li><a class="tocitem" href="../../../tutorials/getting_started/performance_tips/">Performance tips</a></li><li><a class="tocitem" href="../../../tutorials/getting_started/design_patterns_for_larger_models/">Design patterns for larger models</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-2" type="checkbox"/><label class="tocitem" for="menuitem-2-2"><span class="docs-label">Linear programs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../tutorials/linear/introduction/">Introduction</a></li><li><a class="tocitem" href="../../../tutorials/linear/tips_and_tricks/">Tips and tricks</a></li><li><a class="tocitem" href="../../../tutorials/linear/diet/">The diet problem</a></li><li><a class="tocitem" href="../../../tutorials/linear/cannery/">The cannery problem</a></li><li><a class="tocitem" href="../../../tutorials/linear/facility_location/">The facility location problem</a></li><li><a class="tocitem" href="../../../tutorials/linear/factory_schedule/">The factory schedule example</a></li><li><a class="tocitem" href="../../../tutorials/linear/finance/">Financial modeling problems</a></li><li><a class="tocitem" href="../../../tutorials/linear/geographic_clustering/">Geographical clustering</a></li><li><a class="tocitem" href="../../../tutorials/linear/knapsack/">The knapsack problem</a></li><li><a class="tocitem" href="../../../tutorials/linear/multi/">The multi-commodity flow problem</a></li><li><a class="tocitem" href="../../../tutorials/linear/n-queens/">N-Queens</a></li><li><a class="tocitem" href="../../../tutorials/linear/lp_sensitivity/">Sensitivity analysis of a linear program</a></li><li><a class="tocitem" href="../../../tutorials/linear/network_flows/">Network flow problems</a></li><li><a class="tocitem" href="../../../tutorials/linear/prod/">The workforce scheduling problem</a></li><li><a class="tocitem" href="../../../tutorials/linear/steelT3/">The SteelT3 problem</a></li><li><a class="tocitem" href="../../../tutorials/linear/sudoku/">Sudoku</a></li><li><a class="tocitem" href="../../../tutorials/linear/transp/">The transportation problem</a></li><li><a class="tocitem" href="../../../tutorials/linear/urban_plan/">The urban planning problem</a></li><li><a class="tocitem" href="../../../tutorials/linear/callbacks/">Callbacks</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-3" type="checkbox"/><label class="tocitem" for="menuitem-2-3"><span class="docs-label">Nonlinear programs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../tutorials/nonlinear/introduction/">Introduction</a></li><li><a class="tocitem" href="../../../tutorials/nonlinear/tips_and_tricks/">Tips and tricks</a></li><li><a class="tocitem" href="../../../tutorials/nonlinear/portfolio/">Quadratic portfolio optimization</a></li><li><a class="tocitem" href="../../../tutorials/nonlinear/qcp/">Quadratically constrained programs</a></li><li><a class="tocitem" href="../../../tutorials/nonlinear/space_shuttle_reentry_trajectory/">Optimal control for a Space Shuttle reentry trajectory</a></li><li><a class="tocitem" href="../../../tutorials/nonlinear/rocket_control/">Rocket Control</a></li><li><a class="tocitem" href="../../../tutorials/nonlinear/rosenbrock/">The Rosenbrock function</a></li><li><a class="tocitem" href="../../../tutorials/nonlinear/mle/">Maximum likelihood estimation</a></li><li><a class="tocitem" href="../../../tutorials/nonlinear/clnlbeam/">The clnlbeam problem</a></li><li><a class="tocitem" href="../../../tutorials/nonlinear/user_defined_hessians/">User-defined Hessians</a></li><li><a class="tocitem" href="../../../tutorials/nonlinear/querying_hessians/">Computing Hessians</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-4" type="checkbox"/><label class="tocitem" for="menuitem-2-4"><span class="docs-label">Conic programs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../tutorials/conic/introduction/">Introduction</a></li><li><a class="tocitem" href="../../../tutorials/conic/start_values/">Primal and dual warm-starts</a></li><li><a class="tocitem" href="../../../tutorials/conic/tips_and_tricks/">Tips and Tricks</a></li><li><a class="tocitem" href="../../../tutorials/conic/logistic_regression/">Logistic regression</a></li><li><a class="tocitem" href="../../../tutorials/conic/cluster/">K-means clustering via SDP</a></li><li><a class="tocitem" href="../../../tutorials/conic/corr_sdp/">The correlation problem</a></li><li><a class="tocitem" href="../../../tutorials/conic/experiment_design/">Experiment design</a></li><li><a class="tocitem" href="../../../tutorials/conic/max_cut_sdp/">SDP relaxations: max-cut</a></li><li><a class="tocitem" href="../../../tutorials/conic/min_distortion/">The minimum distortion problem</a></li><li><a class="tocitem" href="../../../tutorials/conic/min_ellipse/">Minimal ellipses</a></li><li><a class="tocitem" href="../../../tutorials/conic/robust_uncertainty/">Robust uncertainty sets</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-5" type="checkbox"/><label class="tocitem" for="menuitem-2-5"><span class="docs-label">Algorithms</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../tutorials/algorithms/benders_decomposition/">Benders decomposition</a></li><li><a class="tocitem" href="../../../tutorials/algorithms/cutting_stock_column_generation/">Column generation</a></li><li><a class="tocitem" href="../../../tutorials/algorithms/tsp_lazy_constraints/">Traveling Salesperson Problem</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-6" type="checkbox"/><label class="tocitem" for="menuitem-2-6"><span class="docs-label">Applications</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../tutorials/applications/power_systems/">Power Systems</a></li><li><a class="tocitem" href="../../../tutorials/applications/web_app/">Serving web apps</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">Manual</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../manual/models/">Models</a></li><li><a class="tocitem" href="../../../manual/variables/">Variables</a></li><li><a class="tocitem" href="../../../manual/constraints/">Constraints</a></li><li><a class="tocitem" href="../../../manual/expressions/">Expressions</a></li><li><a class="tocitem" href="../../../manual/objective/">Objectives</a></li><li><a class="tocitem" href="../../../manual/containers/">Containers</a></li><li><a class="tocitem" href="../../../manual/solutions/">Solutions</a></li><li><a class="tocitem" href="../../../manual/nlp/">Nonlinear Modeling</a></li><li><a class="tocitem" href="../../../manual/callbacks/">Solver-independent Callbacks</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">API Reference</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../reference/models/">Models</a></li><li><a class="tocitem" href="../../../reference/variables/">Variables</a></li><li><a class="tocitem" href="../../../reference/expressions/">Expressions</a></li><li><a class="tocitem" href="../../../reference/objectives/">Objectives</a></li><li><a class="tocitem" href="../../../reference/constraints/">Constraints</a></li><li><a class="tocitem" href="../../../reference/containers/">Containers</a></li><li><a class="tocitem" href="../../../reference/solutions/">Solutions</a></li><li><a class="tocitem" href="../../../reference/nlp/">Nonlinear Modeling</a></li><li><a class="tocitem" href="../../../reference/callbacks/">Callbacks</a></li><li><a class="tocitem" href="../../../reference/extensions/">Extensions</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">Background Information</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../background/algebraic_modeling_languages/">Algebraic modeling languages</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6" type="checkbox"/><label class="tocitem" for="menuitem-6"><span class="docs-label">Developer Docs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../developers/contributing/">Contributing</a></li><li><a class="tocitem" href="../../../developers/extensions/">Extensions</a></li><li><a class="tocitem" href="../../../developers/custom_solver_binaries/">Custom binaries</a></li><li><a class="tocitem" href="../../../developers/style/">Style Guide</a></li><li><a class="tocitem" href="../../../developers/roadmap/">Roadmap</a></li></ul></li><li><a class="tocitem" href="../../../release_notes/">Release notes</a></li><li><input class="collapse-toggle" id="menuitem-8" type="checkbox" checked/><label class="tocitem" for="menuitem-8"><span class="docs-label">MathOptInterface</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-8-1" type="checkbox"/><label class="tocitem" for="menuitem-8-1"><span class="docs-label">Introduction</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../">Introduction</a></li><li><a class="tocitem" href="../../background/motivation/">Motivation</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-8-2" type="checkbox" checked/><label class="tocitem" for="menuitem-8-2"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../example/">Solving a problem using MathOptInterface</a></li><li><a class="tocitem" href="../implementing/">Implementing a solver interface</a></li><li><a class="tocitem" href="../mathprogbase/">Transitioning from MathProgBase</a></li><li class="is-active"><a class="tocitem" href>Implementing a constraint bridge</a><ul class="internal"><li><a class="tocitem" href="#Preliminaries"><span>Preliminaries</span></a></li><li><a class="tocitem" href="#Four-mandatory-parts-in-a-constraint-bridge"><span>Four mandatory parts in a constraint bridge</span></a></li><li><a class="tocitem" href="#Bridge-registration"><span>Bridge registration</span></a></li><li><a class="tocitem" href="#Bridge-improvements"><span>Bridge improvements</span></a></li></ul></li><li><a class="tocitem" href="../manipulating_expressions/">Manipulating expressions</a></li><li><a class="tocitem" href="../latency/">Latency</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-8-3" type="checkbox"/><label class="tocitem" for="menuitem-8-3"><span class="docs-label">Manual</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../manual/standard_form/">Standard form problem</a></li><li><a class="tocitem" href="../../manual/models/">Models</a></li><li><a class="tocitem" href="../../manual/variables/">Variables</a></li><li><a class="tocitem" href="../../manual/constraints/">Constraints</a></li><li><a class="tocitem" href="../../manual/solutions/">Solutions</a></li><li><a class="tocitem" href="../../manual/modification/">Problem modification</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-8-4" type="checkbox"/><label class="tocitem" for="menuitem-8-4"><span class="docs-label">Background</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../background/duality/">Duality</a></li><li><a class="tocitem" href="../../background/infeasibility_certificates/">Infeasibility certificates</a></li><li><a class="tocitem" href="../../background/naming_conventions/">Naming conventions</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-8-5" type="checkbox"/><label class="tocitem" for="menuitem-8-5"><span class="docs-label">API Reference</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../reference/standard_form/">Standard form</a></li><li><a class="tocitem" href="../../reference/models/">Models</a></li><li><a class="tocitem" href="../../reference/variables/">Variables</a></li><li><a class="tocitem" href="../../reference/constraints/">Constraints</a></li><li><a class="tocitem" href="../../reference/modification/">Modifications</a></li><li><a class="tocitem" href="../../reference/nonlinear/">Nonlinear programming</a></li><li><a class="tocitem" href="../../reference/callbacks/">Callbacks</a></li><li><a class="tocitem" href="../../reference/errors/">Errors</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-8-6" type="checkbox"/><label class="tocitem" for="menuitem-8-6"><span class="docs-label">Submodules</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-8-6-1" type="checkbox"/><label class="tocitem" for="menuitem-8-6-1"><span class="docs-label">Benchmarks</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../submodules/Benchmarks/overview/">Overview</a></li><li><a class="tocitem" href="../../submodules/Benchmarks/reference/">API Reference</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-8-6-2" type="checkbox"/><label class="tocitem" for="menuitem-8-6-2"><span class="docs-label">Bridges</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../submodules/Bridges/overview/">Overview</a></li><li><a class="tocitem" href="../../submodules/Bridges/list_of_bridges/">List of bridges</a></li><li><a class="tocitem" href="../../submodules/Bridges/reference/">API Reference</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-8-6-3" type="checkbox"/><label class="tocitem" for="menuitem-8-6-3"><span class="docs-label">FileFormats</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../submodules/FileFormats/overview/">Overview</a></li><li><a class="tocitem" href="../../submodules/FileFormats/reference/">API Reference</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-8-6-4" type="checkbox"/><label class="tocitem" for="menuitem-8-6-4"><span class="docs-label">Nonlinear</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../submodules/Nonlinear/overview/">Overview</a></li><li><a class="tocitem" href="../../submodules/Nonlinear/reference/">API Reference</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-8-6-5" type="checkbox"/><label class="tocitem" for="menuitem-8-6-5"><span class="docs-label">Utilities</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../submodules/Utilities/overview/">Overview</a></li><li><a class="tocitem" href="../../submodules/Utilities/reference/">API Reference</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-8-6-6" type="checkbox"/><label class="tocitem" for="menuitem-8-6-6"><span class="docs-label">Test</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../submodules/Test/overview/">Overview</a></li><li><a class="tocitem" href="../../submodules/Test/reference/">API Reference</a></li></ul></li></ul></li><li><a class="tocitem" href="../../release_notes/">Release notes</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">MathOptInterface</a></li><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Implementing a constraint bridge</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Implementing a constraint bridge</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/jump-dev/JuMP.jl/blob/master/docs/src/moi/tutorials/bridging_constraint.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Implementing-a-constraint-bridge"><a class="docs-heading-anchor" href="#Implementing-a-constraint-bridge">Implementing a constraint bridge</a><a id="Implementing-a-constraint-bridge-1"></a><a class="docs-heading-anchor-permalink" href="#Implementing-a-constraint-bridge" title="Permalink"></a></h1><p>This guide outlines the basic steps to create a new bridge from a constraint expressed in the formalism <code>Function</code>-in-<code>Set</code>.</p><h2 id="Preliminaries"><a class="docs-heading-anchor" href="#Preliminaries">Preliminaries</a><a id="Preliminaries-1"></a><a class="docs-heading-anchor-permalink" href="#Preliminaries" title="Permalink"></a></h2><p>First, decide on the set you want to bridge. Then, study its properties: the most important one is whether the set is scalar or vector, which impacts the dimensionality of the functions that can be used with the set.</p><ul><li>A scalar function only has one dimension. MOI defines three types of scalar functions: a variable (<a href="../../reference/standard_form/#MathOptInterface.VariableIndex"><code>VariableIndex</code></a>), an affine function (<a href="../../reference/standard_form/#MathOptInterface.ScalarAffineFunction"><code>ScalarAffineFunction</code></a>), or a quadratic function (<a href="../../reference/standard_form/#MathOptInterface.ScalarQuadraticFunction"><code>ScalarQuadraticFunction</code></a>).</li><li>A vector function has several dimensions (at least one). MOI defines three types of vector functions: several variables (<a href="../../reference/standard_form/#MathOptInterface.VectorOfVariables"><code>VectorOfVariables</code></a>), an affine function (<a href="../../reference/standard_form/#MathOptInterface.VectorAffineFunction"><code>VectorAffineFunction</code></a>), or a quadratic function (<a href="../../reference/standard_form/#MathOptInterface.VectorQuadraticFunction"><code>VectorQuadraticFunction</code></a>). The main difference with scalar functions is that the order of dimensions can be very important: for instance, in an indicator constraint (<a href="../../reference/standard_form/#MathOptInterface.Indicator"><code>Indicator</code></a>), the first dimension indicates whether the constraint about the second dimension is active.</li></ul><p>To explain how to implement a bridge, we present the example of <a href="../../submodules/Bridges/reference/#MathOptInterface.Bridges.Constraint.FlipSignBridge"><code>Bridges.Constraint.FlipSignBridge</code></a>. This bridge maps <code>&lt;=</code> (<a href="../../reference/standard_form/#MathOptInterface.LessThan"><code>LessThan</code></a>) constraints to <code>&gt;=</code> (<a href="../../reference/standard_form/#MathOptInterface.GreaterThan"><code>GreaterThan</code></a>) constraints. This corresponds to reversing the sign of the inequality. We focus on scalar affine functions (we disregard the cases of a single variable or of quadratic functions). This example is a simplified version of the code included in MOI.</p><h2 id="Four-mandatory-parts-in-a-constraint-bridge"><a class="docs-heading-anchor" href="#Four-mandatory-parts-in-a-constraint-bridge">Four mandatory parts in a constraint bridge</a><a id="Four-mandatory-parts-in-a-constraint-bridge-1"></a><a class="docs-heading-anchor-permalink" href="#Four-mandatory-parts-in-a-constraint-bridge" title="Permalink"></a></h2><p>The first part of a constraint bridge is a new concrete subtype of <a href="../../submodules/Bridges/reference/#MathOptInterface.Bridges.Constraint.AbstractBridge"><code>Bridges.Constraint.AbstractBridge</code></a>. This type must have fields to store all the new variables and constraints that the bridge will add. Typically, these types are parametrized by the type of the coefficients in the model.</p><p>Then, three sets of functions must be defined:</p><ol><li><a href="../../submodules/Bridges/reference/#MathOptInterface.Bridges.Constraint.bridge_constraint"><code>Bridges.Constraint.bridge_constraint</code></a>: this function implements the bridge and creates the required variables and constraints.</li><li><a href="../../reference/constraints/#MathOptInterface.supports_constraint"><code>supports_constraint</code></a>: these functions must return <code>true</code> when the combination of function and set is supported by the bridge. By default, the base implementation always returns <code>false</code> and the bridge does not have to provide this implementation.</li><li><a href="../../submodules/Bridges/reference/#MathOptInterface.Bridges.added_constrained_variable_types"><code>Bridges.added_constrained_variable_types</code></a> and <a href="../../submodules/Bridges/reference/#MathOptInterface.Bridges.added_constraint_types"><code>Bridges.added_constraint_types</code></a>: these functions return the types of variables and constraints that this bridge adds. They are used to compute the set of other bridges that are required to use the one you are defining, if need be.</li></ol><p>More functions can be implemented, for instance to retrieve properties from the bridge or deleting a bridged constraint.</p><h3 id=".-Structure-for-the-bridge"><a class="docs-heading-anchor" href="#.-Structure-for-the-bridge">1. Structure for the bridge</a><a id=".-Structure-for-the-bridge-1"></a><a class="docs-heading-anchor-permalink" href="#.-Structure-for-the-bridge" title="Permalink"></a></h3><p>A typical <code>struct</code> behind a bridge depends on the type of the coefficients that are used for the model (typically <code>Float64</code>, but coefficients might also be integers or complex numbers).</p><p>This structure must hold a reference to all the variables and the constraints that are created as part of the bridge.</p><p>The type of this structure is used throughout MOI as an identifier for the bridge. It is passed as argument to most functions related to bridges.</p><p>The best practice is to have the name of this type end with <code>Bridge</code>.</p><p>In our example, the bridge maps any <code>ScalarAffineFunction{T}</code>-in-<code>LessThan{T}</code> constraint to a single <code>ScalarAffineFunction{T}</code>-in-<code>GreaterThan{T}</code> constraint. The affine function has coefficients of type <code>T</code>. The bridge is parametrized with <code>T</code>, so that the constraint that the bridge creates also has coefficients of type <code>T</code>.</p><pre><code class="language-julia hljs">struct SignBridge{T&lt;:Number} &lt;: Bridges.Constraint.AbstractBridge
    constraint::ConstraintIndex{ScalarAffineFunction{T}, GreaterThan{T}}
end</code></pre><h3 id=".-Bridge-creation"><a class="docs-heading-anchor" href="#.-Bridge-creation">2. Bridge creation</a><a id=".-Bridge-creation-1"></a><a class="docs-heading-anchor-permalink" href="#.-Bridge-creation" title="Permalink"></a></h3><p>The function <a href="../../submodules/Bridges/reference/#MathOptInterface.Bridges.Constraint.bridge_constraint"><code>Bridges.Constraint.bridge_constraint</code></a> is called whenever the bridge is instantiated for a specific model, with the given function and set. The arguments to <code>bridge_constraint</code> are similar to <a href="../../reference/constraints/#MathOptInterface.add_constraint"><code>add_constraint</code></a>, with the exception of the first argument: it is the <code>Type</code> of the struct defined in the first step (for our example, <code>Type{SignBridge{T}}</code>).</p><p><code>bridge_constraint</code> returns an instance of the struct defined in the first step. the first step.</p><p>In our example, the bridge constraint could be defined as:</p><pre><code class="language-julia hljs">function Bridges.Constraint.bridge_constraint(
    ::Type{SignBridge{T}}, # Bridge to use.
    model::ModelLike, # Model to which the constraint is being added.
    f::ScalarAffineFunction{T}, # Function to rewrite.
    s::LessThan{T}, # Set to rewrite.
) where {T}
    # Create the variables and constraints required for the bridge.
    con = add_constraint(model, -f, GreaterThan(-s.upper))

    # Return an instance of the bridge type with a reference to all the
    # variables and constraints that were created in this function.
    return SignBridge(con)
end</code></pre><h3 id=".-Supported-constraint-types"><a class="docs-heading-anchor" href="#.-Supported-constraint-types">3. Supported constraint types</a><a id=".-Supported-constraint-types-1"></a><a class="docs-heading-anchor-permalink" href="#.-Supported-constraint-types" title="Permalink"></a></h3><p>The function <a href="../../reference/constraints/#MathOptInterface.supports_constraint"><code>supports_constraint</code></a> determines whether the bridge type supports a given combination of function and set.</p><p>This function must closely match <code>bridge_constraint</code>, because it will not be called if <code>supports_constraint</code> returns <code>false</code>.</p><pre><code class="language-julia hljs">function supports_constraint(
    ::Type{SignBridge{T}}, # Bridge to use.
    ::Type{ScalarAffineFunction{T}}, # Function to rewrite.
    ::Type{LessThan{T}}, # Set to rewrite.
) where {T}
    # Do some computation to ensure that the constraint is supported.
    # Typically, you can directly return true.
    return true
end</code></pre><h3 id=".-Metadata-about-the-bridge"><a class="docs-heading-anchor" href="#.-Metadata-about-the-bridge">4. Metadata about the bridge</a><a id=".-Metadata-about-the-bridge-1"></a><a class="docs-heading-anchor-permalink" href="#.-Metadata-about-the-bridge" title="Permalink"></a></h3><p>To determine whether a bridge can be used, MOI uses a shortest-path algorithm that uses the variable types and the constraints that the bridge can create. This information is communicated from the bridge to MOI using the functions <a href="../../submodules/Bridges/reference/#MathOptInterface.Bridges.added_constrained_variable_types"><code>Bridges.added_constrained_variable_types</code></a> and <a href="../../submodules/Bridges/reference/#MathOptInterface.Bridges.added_constraint_types"><code>Bridges.added_constraint_types</code></a>. Both return lists of tuples: either a list of 1-tuples containing the variable types (typically, <code>ZeroOne</code> or <code>Integer</code>) or a list of 2-tuples contained the functions and sets (like <code>ScalarAffineFunction{T}</code>-<code>GreaterThan</code>).</p><p>For our example, the bridge does not create any constrained variables, and only <code>ScalarAffineFunction{T}</code>-in-<code>GreaterThan{T}</code> constraints:</p><pre><code class="language-julia hljs">function Bridges.added_constrained_variable_types(::Type{SignBridge{T}}) where {T}
    # The bridge does not create variables, return an empty list of tuples:
    return Tuple{Type}[]
end

function Bridges.added_constraint_types(::Type{SignBridge{T}}) where {T}
    return Tuple{Type,Type}[
        # One element per F-in-S the bridge creates.
        (ScalarAffineFunction{T}, GreaterThan{T}),
    ]
end</code></pre><p>A bridge that creates binary variables would rather have this definition of <code>added_constrained_variable_types</code>:</p><pre><code class="language-julia hljs">function Bridges.added_constrained_variable_types(::Type{SomeBridge{T}}) where {T}
    # The bridge only creates binary variables:
    return Tuple{Type}[(ZeroOne,)]
end</code></pre><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>If you declare the creation of constrained variables in <code>added_constrained_variable_types</code>, the corresponding constraint type <code>VariableIndex</code> must not be indicated in <code>added_constraint_types</code>. This would restrict the use of the bridge to solvers that can add such a constraint after the variable is created.</p><p>More concretely, <em>if</em> you declare in <code>added_constrained_variable_types</code> that your bridge creates binary variables (<code>ZeroOne</code>), <em>and if</em> you never add such a constraint afterward (you do not call <code>add_constraint(model, var, ZeroOne())</code>), then you must <em>not</em> list <code>(VariableIndex, ZeroOne)</code> in <code>added_constraint_types</code>.</p></div></div><p>Typically, the function <a href="../../submodules/Bridges/reference/#MathOptInterface.Bridges.Constraint.concrete_bridge_type"><code>Bridges.Constraint.concrete_bridge_type</code></a> does not have to be defined for most bridges.</p><h2 id="Bridge-registration"><a class="docs-heading-anchor" href="#Bridge-registration">Bridge registration</a><a id="Bridge-registration-1"></a><a class="docs-heading-anchor-permalink" href="#Bridge-registration" title="Permalink"></a></h2><p>For a bridge to be used by MOI, it must be known by MOI.</p><h3 id="SingleBridgeOptimizer"><a class="docs-heading-anchor" href="#SingleBridgeOptimizer"><code>SingleBridgeOptimizer</code></a><a id="SingleBridgeOptimizer-1"></a><a class="docs-heading-anchor-permalink" href="#SingleBridgeOptimizer" title="Permalink"></a></h3><p>The first way to do so is to create a single-bridge optimizer. This type of optimizer wraps another optimizer and adds the possibility to use only one bridge. It is especially useful when unit testing bridges.</p><p>It is common practice to use the same name as the type defined for the bridge (<code>SignBridge</code>, in our example) without the suffix <code>Bridge</code>.</p><pre><code class="language-julia hljs">const Sign{T,OT&lt;: ModelLike} =
    SingleBridgeOptimizer{SignBridge{T}, OT}</code></pre><p>In the context of unit tests, this bridge is used in conjunction with a <a href="../../submodules/Utilities/reference/#MathOptInterface.Utilities.MockOptimizer"><code>Utilities.MockOptimizer</code></a>:</p><pre><code class="language-julia hljs">mock = Utilities.MockOptimizer(
    Utilities.UniversalFallback(Utilities.Model{Float64}()),
)
bridged_mock = Sign{Float64}(mock)</code></pre><h3 id="New-bridge-for-a-LazyBridgeOptimizer"><a class="docs-heading-anchor" href="#New-bridge-for-a-LazyBridgeOptimizer">New bridge for a <code>LazyBridgeOptimizer</code></a><a id="New-bridge-for-a-LazyBridgeOptimizer-1"></a><a class="docs-heading-anchor-permalink" href="#New-bridge-for-a-LazyBridgeOptimizer" title="Permalink"></a></h3><p>Typical user-facing models for MOI are based on <a href="../../submodules/Bridges/reference/#MathOptInterface.Bridges.LazyBridgeOptimizer"><code>Bridges.LazyBridgeOptimizer</code></a>. For instance, this type of model is returned by <a href="../../submodules/Bridges/reference/#MathOptInterface.Bridges.full_bridge_optimizer"><code>Bridges.full_bridge_optimizer</code></a>. These models can be added more bridges by using <a href="../../submodules/Bridges/reference/#MathOptInterface.Bridges.add_bridge"><code>Bridges.add_bridge</code></a>:</p><pre><code class="language-julia hljs">inner_optimizer = Utilities.Model{Float64}()
optimizer = Bridges.full_bridge_optimizer(inner_optimizer, Float64)
Bridges.add_bridge(optimizer, SignBridge{Float64})</code></pre><h2 id="Bridge-improvements"><a class="docs-heading-anchor" href="#Bridge-improvements">Bridge improvements</a><a id="Bridge-improvements-1"></a><a class="docs-heading-anchor-permalink" href="#Bridge-improvements" title="Permalink"></a></h2><h3 id="Attribute-retrieval"><a class="docs-heading-anchor" href="#Attribute-retrieval">Attribute retrieval</a><a id="Attribute-retrieval-1"></a><a class="docs-heading-anchor-permalink" href="#Attribute-retrieval" title="Permalink"></a></h3><p>Like models, bridges have attributes that can be retrieved using <a href="../../reference/models/#MathOptInterface.get"><code>get</code></a> and <a href="../../reference/models/#MathOptInterface.set"><code>set</code></a>. The most important ones are the number of variables and constraints, but also the lists of variables and constraints.</p><p>In our example, we only have one constraint and only have to implement the <a href="../../reference/models/#MathOptInterface.NumberOfConstraints"><code>NumberOfConstraints</code></a> and <a href="../../reference/models/#MathOptInterface.ListOfConstraintIndices"><code>ListOfConstraintIndices</code></a> attributes:</p><pre><code class="language-julia hljs">function get(
    ::SignBridge{T},
    ::NumberOfConstraints{
        ScalarAffineFunction{T},
        GreaterThan{T},
    },
) where {T}
    return 1
end

function get(
    bridge::SignBridge{T},
    ::ListOfConstraintIndices{
        ScalarAffineFunction{T},
        GreaterThan{T},
    },
) where {T}
    return [bridge.constraint]
end</code></pre><p>You must implement one such pair of functions for each type of constraint the bridge adds to the model.</p><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>Avoid returning a list from the bridge object without copying it. Users must be able to change the contents of the returned list without altering the bridge object.</p></div></div><p>For variables, the situation is simpler. If your bridge creates new variables, you must implement the <a href="../../reference/models/#MathOptInterface.NumberOfVariables"><code>NumberOfVariables</code></a> and <a href="../../reference/models/#MathOptInterface.ListOfVariableIndices"><code>ListOfVariableIndices</code></a> attributes. However, these attributes do not have parameters, unlike their constraint counterparts. Only two functions suffice:</p><pre><code class="language-julia hljs">function get(
    ::SignBridge{T},
    ::NumberOfVariables,
) where {T}
    return 0
end

function get(
    ::SignBridge{T},
    ::ListOfVariableIndices,
) where {T}
    return VariableIndex[]
end</code></pre><p>In order for the user to be able to access the function and set of the original constraint, the bridge needs to implement getters for the <a href="../../reference/constraints/#MathOptInterface.ConstraintFunction"><code>ConstraintFunction</code></a> and <a href="../../reference/constraints/#MathOptInterface.ConstraintSet"><code>ConstraintSet</code></a> attributes:</p><pre><code class="language-julia hljs">function get(
    model::MOI.ModelLike,
    attr::MOI.ConstraintFunction,
    bridge::SignBridge,
)
    return -MOI.get(model, attr, bridge.constraint)
end

function get(
    model::MOI.ModelLike,
    attr::MOI.ConstraintSet,
    bridge::SignBridge,
)
    set = MOI.get(model, attr, bridge.constraint)
    return MOI.LessThan(-set.lower)
end</code></pre><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>Alternatively, one could store the original function and set in <code>SignBridge</code> during <a href="../../submodules/Bridges/reference/#MathOptInterface.Bridges.Constraint.bridge_constraint"><code>Bridges.Constraint.bridge_constraint</code></a> to make these getters simpler and more efficient. On the other hand, this will increase the memory footprint of the bridges as the garbage collector won&#39;t be able to delete that object. The convention is to not store the function in the bridge and not care too much about the efficiency of these getters. If the user needs efficient getters for <a href="../../reference/constraints/#MathOptInterface.ConstraintFunction"><code>ConstraintFunction</code></a> then they should use a <a href="../../submodules/Utilities/reference/#MathOptInterface.Utilities.CachingOptimizer"><code>Utilities.CachingOptimizer</code></a>.</p></div></div><h3 id="Model-modifications"><a class="docs-heading-anchor" href="#Model-modifications">Model modifications</a><a id="Model-modifications-1"></a><a class="docs-heading-anchor-permalink" href="#Model-modifications" title="Permalink"></a></h3><p>To avoid copying the model when the user request to change a constraint, MOI provides <a href="../../reference/modification/#MathOptInterface.modify"><code>modify</code></a>. Bridges can also implement this API to allow certain changes, such as coefficient changes.</p><p>In our case, a modification of a coefficient in the original constraint (i.e. replacing the value of the coefficient of a variable in the affine function) must be transmitted to the constraint created by the bridge, but with a sign change.</p><pre><code class="language-julia hljs">function modify(
    model::ModelLike,
    bridge::SignBridge,
    change::ScalarCoefficientChange,
)
    modify(
        model,
        bridge.constraint,
        ScalarCoefficientChange(change.variable, -change.new_coefficient),
    )
    return
end</code></pre><h3 id="Bridge-deletion"><a class="docs-heading-anchor" href="#Bridge-deletion">Bridge deletion</a><a id="Bridge-deletion-1"></a><a class="docs-heading-anchor-permalink" href="#Bridge-deletion" title="Permalink"></a></h3><p>When a bridge is deleted, the constraints it added must be deleted too.</p><pre><code class="language-julia hljs">function delete(model::ModelLike, bridge::SignBridge)
    delete(model, bridge.constraint)
    return
end</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../mathprogbase/">« Transitioning from MathProgBase</a><a class="docs-footer-nextpage" href="../manipulating_expressions/">Manipulating expressions »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.22 on <span class="colophon-date" title="Monday 22 August 2022 03:33">Monday 22 August 2022</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
