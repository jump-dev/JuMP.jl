<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Example: fitting of circles and ellipses · JuMP</title><meta name="title" content="Example: fitting of circles and ellipses · JuMP"/><meta property="og:title" content="Example: fitting of circles and ellipses · JuMP"/><meta property="twitter:title" content="Example: fitting of circles and ellipses · JuMP"/><meta name="description" content="Documentation for JuMP."/><meta property="og:description" content="Documentation for JuMP."/><meta property="twitter:description" content="Documentation for JuMP."/><script async src="https://www.googletagmanager.com/gtag/js?id=G-0RZ8X3D3D0"></script><script>  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-0RZ8X3D3D0', {'page_path': location.pathname + location.search + location.hash});
</script><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../search_index.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script><link href="../../../assets/extra_styles.css" rel="stylesheet" type="text/css"/><link href="../../../assets/citations.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../"><img class="docs-light-only" src="../../../assets/logo.svg" alt="JuMP logo"/><img class="docs-dark-only" src="../../../assets/logo-dark.svg" alt="JuMP logo"/></a><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><input class="collapse-toggle" id="menuitem-1" type="checkbox"/><label class="tocitem" for="menuitem-1"><span class="docs-label">Introduction</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../">Introduction</a></li><li><a class="tocitem" href="../../../should_i_use/">Should you use JuMP?</a></li><li><a class="tocitem" href="../../../installation/">Installation Guide</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox" checked/><label class="tocitem" for="menuitem-2"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-2-1" type="checkbox"/><label class="tocitem" for="menuitem-2-1"><span class="docs-label">Getting started</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../getting_started/introduction/">Introduction</a></li><li><a class="tocitem" href="../../getting_started/getting_started_with_julia/">Getting started with Julia</a></li><li><a class="tocitem" href="../../getting_started/getting_started_with_JuMP/">Getting started with JuMP</a></li><li><a class="tocitem" href="../../getting_started/getting_started_with_sets_and_indexing/">Getting started with sets and indexing</a></li><li><a class="tocitem" href="../../getting_started/getting_started_with_data_and_plotting/">Getting started with data and plotting</a></li><li><a class="tocitem" href="../../getting_started/debugging/">Debugging</a></li><li><a class="tocitem" href="../../getting_started/tolerances/">Tolerances and numerical issues</a></li><li><a class="tocitem" href="../../getting_started/design_patterns_for_larger_models/">Design patterns for larger models</a></li><li><a class="tocitem" href="../../getting_started/performance_tips/">Performance tips</a></li><li><a class="tocitem" href="../../getting_started/sum_if/">Performance problems with sum-if formulations</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-2" type="checkbox"/><label class="tocitem" for="menuitem-2-2"><span class="docs-label">Transitioning</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../transitioning/transitioning_from_matlab/">Transitioning from MATLAB</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-3" type="checkbox"/><label class="tocitem" for="menuitem-2-3"><span class="docs-label">Linear programs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../linear/introduction/">Introduction</a></li><li><a class="tocitem" href="../../linear/knapsack/">The knapsack problem example</a></li><li><a class="tocitem" href="../../linear/diet/">The diet problem</a></li><li><a class="tocitem" href="../../linear/cannery/">The cannery problem</a></li><li><a class="tocitem" href="../../linear/typed_indices/">Strategies for dealing with many indices</a></li><li><a class="tocitem" href="../../linear/factory_schedule/">The factory schedule example</a></li><li><a class="tocitem" href="../../linear/multi/">The multi-commodity flow problem</a></li><li><a class="tocitem" href="../../linear/multi_commodity_network/">The network multi-commodity flow problem</a></li><li><a class="tocitem" href="../../linear/tips_and_tricks/">Tips and tricks</a></li><li><a class="tocitem" href="../../linear/piecewise_linear/">Approximating nonlinear functions</a></li><li><a class="tocitem" href="../../linear/facility_location/">The facility location problem</a></li><li><a class="tocitem" href="../../linear/finance/">Financial modeling problems</a></li><li><a class="tocitem" href="../../linear/geographic_clustering/">Geographical clustering</a></li><li><a class="tocitem" href="../../linear/network_flows/">Network flow problems</a></li><li><a class="tocitem" href="../../linear/transp/">The transportation problem</a></li><li><a class="tocitem" href="../../linear/multi_objective_knapsack/">Multi-objective knapsack</a></li><li><a class="tocitem" href="../../linear/multi_objective_examples/">Simple multi-objective examples</a></li><li><a class="tocitem" href="../../linear/sudoku/">Sudoku</a></li><li><a class="tocitem" href="../../linear/n-queens/">N-Queens</a></li><li><a class="tocitem" href="../../linear/constraint_programming/">Constraint programming</a></li><li><a class="tocitem" href="../../linear/callbacks/">Callbacks</a></li><li><a class="tocitem" href="../../linear/lp_sensitivity/">Sensitivity analysis of a linear program</a></li><li><a class="tocitem" href="../../linear/basis/">Basis matrices</a></li><li><a class="tocitem" href="../../linear/mip_duality/">Computing the duals of a mixed-integer program</a></li><li><a class="tocitem" href="../../linear/multiple_solutions/">Finding multiple feasible solutions</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-4" type="checkbox"/><label class="tocitem" for="menuitem-2-4"><span class="docs-label">Nonlinear programs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../nonlinear/introduction/">Introduction</a></li><li><a class="tocitem" href="../../nonlinear/simple_examples/">Simple examples</a></li><li><a class="tocitem" href="../../nonlinear/tips_and_tricks/">User-defined operators with vector outputs</a></li><li><a class="tocitem" href="../../nonlinear/operator_ad/">Automatic differentiation of user-defined operators</a></li><li><a class="tocitem" href="../../nonlinear/user_defined_hessians/">User-defined Hessians</a></li><li><a class="tocitem" href="../../nonlinear/nested_problems/">Nested optimization problems</a></li><li><a class="tocitem" href="../../nonlinear/querying_hessians/">Computing Hessians</a></li><li><a class="tocitem" href="../../nonlinear/complementarity/">Example: mixed complementarity problems</a></li><li><a class="tocitem" href="../../nonlinear/classifiers/">Example: classification problems</a></li><li><a class="tocitem" href="../../nonlinear/portfolio/">Example: portfolio optimization</a></li><li><a class="tocitem" href="../../nonlinear/rocket_control/">Example: nonlinear optimal control of a rocket</a></li><li><a class="tocitem" href="../../nonlinear/space_shuttle_reentry_trajectory/">Example: optimal control for a Space Shuttle reentry trajectory</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-5" type="checkbox" checked/><label class="tocitem" for="menuitem-2-5"><span class="docs-label">Conic programs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../introduction/">Introduction</a></li><li><a class="tocitem" href="../tips_and_tricks/">Modeling with cones</a></li><li><a class="tocitem" href="../dualization/">Dualization</a></li><li><a class="tocitem" href="../arbitrary_precision/">Arbitrary precision arithmetic</a></li><li><a class="tocitem" href="../start_values/">Primal and dual warm-starts</a></li><li><a class="tocitem" href="../simple_examples/">Simple semidefinite programming examples</a></li><li><a class="tocitem" href="../chordal_decomposition/">Chordal decomposition</a></li><li><a class="tocitem" href="../logistic_regression/">Example: logistic regression</a></li><li><a class="tocitem" href="../experiment_design/">Example: experiment design</a></li><li><a class="tocitem" href="../min_ellipse/">Example: minimal ellipses</a></li><li><a class="tocitem" href="../ellipse_approx/">Example: ellipsoid approximation</a></li><li class="is-active"><a class="tocitem" href>Example: fitting of circles and ellipses</a><ul class="internal"><li><a class="tocitem" href="#Required-packages"><span>Required packages</span></a></li><li><a class="tocitem" href="#Parametrization-of-an-ellipse"><span>Parametrization of an ellipse</span></a></li><li><a class="tocitem" href="#Helper-functions"><span>Helper functions</span></a></li><li><a class="tocitem" href="#Reading-the-test-image"><span>Reading the test image</span></a></li><li><a class="tocitem" href="#Extracting-image-features"><span>Extracting image features</span></a></li><li><a class="tocitem" href="#Edge-detection-and-clustering"><span>Edge detection and clustering</span></a></li><li><a class="tocitem" href="#Fitting-ellipses"><span>Fitting ellipses</span></a></li><li><a class="tocitem" href="#Objective-1:-Minimize-the-total-squared-distance"><span>Objective 1: Minimize the total squared distance</span></a></li><li><a class="tocitem" href="#Objective-2:-Minimize-the-maximum-residual-distance"><span>Objective 2: Minimize the maximum residual distance</span></a></li></ul></li><li><a class="tocitem" href="../quantum_discrimination/">Example: quantum state discrimination</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-6" type="checkbox"/><label class="tocitem" for="menuitem-2-6"><span class="docs-label">Algorithms</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../algorithms/benders_decomposition/">Benders decomposition</a></li><li><a class="tocitem" href="../../algorithms/cutting_stock_column_generation/">Column generation</a></li><li><a class="tocitem" href="../../algorithms/tsp_lazy_constraints/">Traveling Salesperson Problem</a></li><li><a class="tocitem" href="../../algorithms/rolling_horizon/">Rolling horizon problems</a></li><li><a class="tocitem" href="../../algorithms/parallelism/">Parallelism</a></li><li><a class="tocitem" href="../../algorithms/pdhg/">Writing a solver interface</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-7" type="checkbox"/><label class="tocitem" for="menuitem-2-7"><span class="docs-label">Applications</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../applications/power_systems/">Power Systems</a></li><li><a class="tocitem" href="../../applications/optimal_power_flow/">Optimal power flow</a></li><li><a class="tocitem" href="../../applications/web_app/">Serving web apps</a></li><li><a class="tocitem" href="../../applications/two_stage_stochastic/">Two-stage stochastic programs</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">Manual</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../manual/models/">Models</a></li><li><a class="tocitem" href="../../../manual/variables/">Variables</a></li><li><a class="tocitem" href="../../../manual/constraints/">Constraints</a></li><li><a class="tocitem" href="../../../manual/expressions/">Expressions</a></li><li><a class="tocitem" href="../../../manual/objective/">Objectives</a></li><li><a class="tocitem" href="../../../manual/containers/">Containers</a></li><li><a class="tocitem" href="../../../manual/solutions/">Solutions</a></li><li><a class="tocitem" href="../../../manual/callbacks/">Solver-independent Callbacks</a></li><li><a class="tocitem" href="../../../manual/complex/">Complex number support</a></li><li><a class="tocitem" href="../../../manual/nonlinear/">Nonlinear Modeling</a></li><li><a class="tocitem" href="../../../manual/nlp/">Nonlinear Modeling (Legacy)</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">API Reference</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../api/JuMP/">JuMP</a></li><li><a class="tocitem" href="../../../api/JuMP.Containers/">JuMP.Containers</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">Background Information</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../background/algebraic_modeling_languages/">Algebraic modeling languages</a></li><li><a class="tocitem" href="../../../background/bibliography/">Bibliography</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6" type="checkbox"/><label class="tocitem" for="menuitem-6"><span class="docs-label">Developer Docs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../developers/contributing/">Contributing</a></li><li><a class="tocitem" href="../../../developers/extensions/">Extensions</a></li><li><a class="tocitem" href="../../../developers/custom_solver_binaries/">Custom binaries</a></li><li><a class="tocitem" href="../../../developers/style/">Style Guide</a></li><li><a class="tocitem" href="../../../developers/conventions/">Conventions</a></li><li><a class="tocitem" href="../../../developers/roadmap/">Roadmap</a></li><li><a class="tocitem" href="../../../developers/checklists/">Checklists</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-7" type="checkbox"/><label class="tocitem" for="menuitem-7"><span class="docs-label">Solvers</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../packages/solvers/">Introduction</a></li><li><a class="tocitem" href="../../../packages/AmplNLWriter/">jump-dev/AmplNLWriter.jl</a></li><li><a class="tocitem" href="../../../packages/BARON/">jump-dev/BARON.jl</a></li><li><a class="tocitem" href="../../../packages/CPLEX/">jump-dev/CPLEX.jl</a></li><li><a class="tocitem" href="../../../packages/CSDP/">jump-dev/CSDP.jl</a></li><li><a class="tocitem" href="../../../packages/Cbc/">jump-dev/Cbc.jl</a></li><li><a class="tocitem" href="../../../packages/Clp/">jump-dev/Clp.jl</a></li><li><a class="tocitem" href="../../../packages/DSDP/">jump-dev/DSDP.jl</a></li><li><a class="tocitem" href="../../../packages/Dualization/">jump-dev/Dualization.jl</a></li><li><a class="tocitem" href="../../../packages/ECOS/">jump-dev/ECOS.jl</a></li><li><a class="tocitem" href="../../../packages/GLPK/">jump-dev/GLPK.jl</a></li><li><a class="tocitem" href="../../../packages/Gurobi/">jump-dev/Gurobi.jl</a></li><li><a class="tocitem" href="../../../packages/HiGHS/">jump-dev/HiGHS.jl</a></li><li><a class="tocitem" href="../../../packages/Hypatia/">jump-dev/Hypatia.jl</a></li><li><a class="tocitem" href="../../../packages/Ipopt/">jump-dev/Ipopt.jl</a></li><li><a class="tocitem" href="../../../packages/KNITRO/">jump-dev/KNITRO.jl</a></li><li><a class="tocitem" href="../../../packages/MathOptAnalyzer/">jump-dev/MathOptAnalyzer.jl</a></li><li><a class="tocitem" href="../../../packages/MathOptIIS/">jump-dev/MathOptIIS.jl</a></li><li><a class="tocitem" href="../../../packages/MiniZinc/">jump-dev/MiniZinc.jl</a></li><li><a class="tocitem" href="../../../packages/MosekTools/">jump-dev/MosekTools.jl</a></li><li><a class="tocitem" href="../../../packages/MultiObjectiveAlgorithms/">jump-dev/MultiObjectiveAlgorithms.jl</a></li><li><a class="tocitem" href="../../../packages/NEOSServer/">jump-dev/NEOSServer.jl</a></li><li><a class="tocitem" href="../../../packages/NLopt/">jump-dev/NLopt.jl</a></li><li><a class="tocitem" href="../../../packages/Pajarito/">jump-dev/Pajarito.jl</a></li><li><a class="tocitem" href="../../../packages/Pavito/">jump-dev/Pavito.jl</a></li><li><a class="tocitem" href="../../../packages/SCS/">jump-dev/SCS.jl</a></li><li><a class="tocitem" href="../../../packages/SDPA/">jump-dev/SDPA.jl</a></li><li><a class="tocitem" href="../../../packages/SDPLR/">jump-dev/SDPLR.jl</a></li><li><a class="tocitem" href="../../../packages/SDPNAL/">jump-dev/SDPNAL.jl</a></li><li><a class="tocitem" href="../../../packages/SDPT3/">jump-dev/SDPT3.jl</a></li><li><a class="tocitem" href="../../../packages/SeDuMi/">jump-dev/SeDuMi.jl</a></li><li><a class="tocitem" href="../../../packages/Xpress/">jump-dev/Xpress.jl</a></li><li><a class="tocitem" href="../../../packages/cuOpt/">jump-dev/cuOpt.jl</a></li><li><a class="tocitem" href="../../../packages/COPT/">COPT-Public/COPT.jl</a></li><li><a class="tocitem" href="../../../packages/GAMS/">GAMS-dev/GAMS.jl</a></li><li><a class="tocitem" href="../../../packages/Manopt/">JuliaManifolds/Manopt.jl</a></li><li><a class="tocitem" href="../../../packages/Optim/">JuliaNLSolvers/Optim.jl</a></li><li><a class="tocitem" href="../../../packages/CDDLib/">JuliaPolyhedra/CDDLib.jl</a></li><li><a class="tocitem" href="../../../packages/Percival/">JuliaSmoothOptimizers/Percival.jl</a></li><li><a class="tocitem" href="../../../packages/MAiNGO/">MAiNGO-github/MAiNGO.jl</a></li><li><a class="tocitem" href="../../../packages/MadNLP/">MadNLP/MadNLP.jl</a></li><li><a class="tocitem" href="../../../packages/EAGO/">PSORLab/EAGO.jl</a></li><li><a class="tocitem" href="../../../packages/PATHSolver/">chkwon/PATHSolver.jl</a></li><li><a class="tocitem" href="../../../packages/DAQP/">darnstrom/DAQP.jl</a></li><li><a class="tocitem" href="../../../packages/Tulip/">ds4dm/Tulip.jl</a></li><li><a class="tocitem" href="../../../packages/CATrustRegionMethod/">fadihamad94/CATrustRegionMethod.jl</a></li><li><a class="tocitem" href="../../../packages/Loraine/">kocvara/Loraine.jl</a></li><li><a class="tocitem" href="../../../packages/Alpine/">lanl-ansi/Alpine.jl</a></li><li><a class="tocitem" href="../../../packages/Juniper/">lanl-ansi/Juniper.jl</a></li><li><a class="tocitem" href="../../../packages/ProxSDP/">mariohsouto/ProxSDP.jl</a></li><li><a class="tocitem" href="../../../packages/OSQP/">osqp/OSQP.jl</a></li><li><a class="tocitem" href="../../../packages/CDCS/">oxfordcontrol/CDCS.jl</a></li><li><a class="tocitem" href="../../../packages/COSMO/">oxfordcontrol/COSMO.jl</a></li><li><a class="tocitem" href="../../../packages/Clarabel/">oxfordcontrol/Clarabel.jl</a></li><li><a class="tocitem" href="../../../packages/MathOptChordalDecomposition/">samuelsonric/MathOptChordalDecomposition.jl</a></li><li><a class="tocitem" href="../../../packages/SCIP/">scipopt/SCIP.jl</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-8" type="checkbox"/><label class="tocitem" for="menuitem-8"><span class="docs-label">Extensions</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../extensions/introduction/">Introduction</a></li><li><a class="tocitem" href="../../../packages/DiffOpt/">jump-dev/DiffOpt.jl</a></li><li><a class="tocitem" href="../../../packages/ParametricOptInterface/">jump-dev/ParametricOptInterface.jl</a></li><li><a class="tocitem" href="../../../packages/PiecewiseLinearOpt/">jump-dev/PiecewiseLinearOpt.jl</a></li><li><a class="tocitem" href="../../../packages/PolyJuMP/">jump-dev/PolyJuMP.jl</a></li><li><a class="tocitem" href="../../../packages/SumOfSquares/">jump-dev/SumOfSquares.jl</a></li><li><a class="tocitem" href="../../../packages/DisjunctiveProgramming/">hdavid16/DisjunctiveProgramming.jl</a></li><li><a class="tocitem" href="../../../packages/InfiniteOpt/">infiniteopt/InfiniteOpt.jl</a></li><li><a class="tocitem" href="../../../packages/BilevelJuMP/">joaquimg/BilevelJuMP.jl</a></li><li><a class="tocitem" href="../../../packages/MathOptAI/">lanl-ansi/MathOptAI.jl</a></li><li><a class="tocitem" href="../../../packages/MathOptSymbolicAD/">lanl-ansi/MathOptSymbolicAD.jl</a></li><li><a class="tocitem" href="../../../packages/SDDP/">odow/SDDP.jl</a></li><li><a class="tocitem" href="../../../packages/Plasmo/">plasmo-dev/Plasmo.jl</a></li><li><a class="tocitem" href="../../../extensions/DimensionalData/">rafaqz/DimensionalData.jl</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-9" type="checkbox"/><label class="tocitem" for="menuitem-9"><span class="docs-label">MathOptInterface</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-9-1" type="checkbox"/><label class="tocitem" for="menuitem-9-1"><span class="docs-label">Introduction</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../moi/">Introduction</a></li><li><a class="tocitem" href="../../../moi/background/motivation/">Motivation</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-9-2" type="checkbox"/><label class="tocitem" for="menuitem-9-2"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../moi/tutorials/example/">Solving a problem using MathOptInterface</a></li><li><a class="tocitem" href="../../../moi/tutorials/implementing/">Implementing a solver interface</a></li><li><a class="tocitem" href="../../../moi/tutorials/mathprogbase/">Transitioning from MathProgBase</a></li><li><a class="tocitem" href="../../../moi/tutorials/bridging_constraint/">Implementing a constraint bridge</a></li><li><a class="tocitem" href="../../../moi/tutorials/manipulating_expressions/">Manipulating expressions</a></li><li><a class="tocitem" href="../../../moi/tutorials/latency/">Latency</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-9-3" type="checkbox"/><label class="tocitem" for="menuitem-9-3"><span class="docs-label">Manual</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../moi/manual/standard_form/">Standard form problem</a></li><li><a class="tocitem" href="../../../moi/manual/models/">Models</a></li><li><a class="tocitem" href="../../../moi/manual/variables/">Variables</a></li><li><a class="tocitem" href="../../../moi/manual/constraints/">Constraints</a></li><li><a class="tocitem" href="../../../moi/manual/solutions/">Solutions</a></li><li><a class="tocitem" href="../../../moi/manual/modification/">Problem modification</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-9-4" type="checkbox"/><label class="tocitem" for="menuitem-9-4"><span class="docs-label">Background</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../moi/background/duality/">Duality</a></li><li><a class="tocitem" href="../../../moi/background/infeasibility_certificates/">Infeasibility certificates</a></li><li><a class="tocitem" href="../../../moi/background/naming_conventions/">Naming conventions</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-9-5" type="checkbox"/><label class="tocitem" for="menuitem-9-5"><span class="docs-label">API Reference</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../moi/reference/standard_form/">Standard form</a></li><li><a class="tocitem" href="../../../moi/reference/models/">Models</a></li><li><a class="tocitem" href="../../../moi/reference/variables/">Variables</a></li><li><a class="tocitem" href="../../../moi/reference/constraints/">Constraints</a></li><li><a class="tocitem" href="../../../moi/reference/modification/">Modifications</a></li><li><a class="tocitem" href="../../../moi/reference/nonlinear/">Nonlinear programming</a></li><li><a class="tocitem" href="../../../moi/reference/callbacks/">Callbacks</a></li><li><a class="tocitem" href="../../../moi/reference/errors/">Errors</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-9-6" type="checkbox"/><label class="tocitem" for="menuitem-9-6"><span class="docs-label">Submodules</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-9-6-1" type="checkbox"/><label class="tocitem" for="menuitem-9-6-1"><span class="docs-label">Benchmarks</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../moi/submodules/Benchmarks/overview/">Overview</a></li><li><a class="tocitem" href="../../../moi/submodules/Benchmarks/reference/">API Reference</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-9-6-2" type="checkbox"/><label class="tocitem" for="menuitem-9-6-2"><span class="docs-label">Bridges</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../moi/submodules/Bridges/overview/">Overview</a></li><li><a class="tocitem" href="../../../moi/submodules/Bridges/implementation/">Implementation</a></li><li><a class="tocitem" href="../../../moi/submodules/Bridges/list_of_bridges/">List of bridges</a></li><li><a class="tocitem" href="../../../moi/submodules/Bridges/reference/">API Reference</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-9-6-3" type="checkbox"/><label class="tocitem" for="menuitem-9-6-3"><span class="docs-label">FileFormats</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../moi/submodules/FileFormats/overview/">Overview</a></li><li><a class="tocitem" href="../../../moi/submodules/FileFormats/reference/">API Reference</a></li><li><a class="tocitem" href="../../../moi/submodules/FileFormats/LP/">The LP file format</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-9-6-4" type="checkbox"/><label class="tocitem" for="menuitem-9-6-4"><span class="docs-label">Nonlinear</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../moi/submodules/Nonlinear/overview/">Overview</a></li><li><a class="tocitem" href="../../../moi/submodules/Nonlinear/SymbolicAD/">SymbolicAD</a></li><li><a class="tocitem" href="../../../moi/submodules/Nonlinear/reference/">API Reference</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-9-6-5" type="checkbox"/><label class="tocitem" for="menuitem-9-6-5"><span class="docs-label">Utilities</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../moi/submodules/Utilities/overview/">Overview</a></li><li><a class="tocitem" href="../../../moi/submodules/Utilities/reference/">API Reference</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-9-6-6" type="checkbox"/><label class="tocitem" for="menuitem-9-6-6"><span class="docs-label">Test</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../moi/submodules/Test/overview/">Overview</a></li><li><a class="tocitem" href="../../../moi/submodules/Test/reference/">API Reference</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-9-7" type="checkbox"/><label class="tocitem" for="menuitem-9-7"><span class="docs-label">Developer Docs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../moi/developer/checklists/">Checklists</a></li></ul></li><li><a class="tocitem" href="../../../moi/release_notes/">Release notes</a></li></ul></li><li><a class="tocitem" href="../../../release_notes/">Release notes</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li><a class="is-disabled">Conic programs</a></li><li class="is-active"><a href>Example: fitting of circles and ellipses</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Example: fitting of circles and ellipses</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/jump-dev/JuMP.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/jump-dev/JuMP.jl/blob/master/docs/src/tutorials/conic/ellipse_fitting.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Example:-fitting-of-circles-and-ellipses"><a class="docs-heading-anchor" href="#Example:-fitting-of-circles-and-ellipses">Example: fitting of circles and ellipses</a><a id="Example:-fitting-of-circles-and-ellipses-1"></a><a class="docs-heading-anchor-permalink" href="#Example:-fitting-of-circles-and-ellipses" title="Permalink"></a></h1><p><em>This tutorial was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em> <a href="../ellipse_fitting.jl"><em>Download the source as a <code>.jl</code> file</em></a>.</p><p>Ellipse fitting is a common task in data analysis and computer vision and is of key importance in many application areas. In this tutorial we show how to fit an ellipse to a set of points using a conic optimization approach.</p><h2 id="Required-packages"><a class="docs-heading-anchor" href="#Required-packages">Required packages</a><a id="Required-packages-1"></a><a class="docs-heading-anchor-permalink" href="#Required-packages" title="Permalink"></a></h2><p>This tutorial uses the following packages:</p><pre><code class="language-julia hljs">using JuMP
import Clarabel
import Clustering
import DSP
import Images
import LinearAlgebra
import LinearOperatorCollection as LOC
import Plots
import RegularizedLeastSquares as RLS
import Wavelets</code></pre><h2 id="Parametrization-of-an-ellipse"><a class="docs-heading-anchor" href="#Parametrization-of-an-ellipse">Parametrization of an ellipse</a><a id="Parametrization-of-an-ellipse-1"></a><a class="docs-heading-anchor-permalink" href="#Parametrization-of-an-ellipse" title="Permalink"></a></h2><p>An ellipse is a set of the form:</p><p class="math-container">\[\mathcal{E} = \{ \xi : (\xi - c)^\top D (\xi - c) = r^2 \}\]</p><p>where <span>$c \in \mathbb{R}^2$</span> is the center of the ellipse, <span>$D \in \mathbb{R}^{2 \times 2} \succ 0$</span> is a symmetric positive definite matrix and <span>$r &gt; 0$</span>.</p><p>We can setup a coordinate system <span>$(x, y) \in \mathbb{X} \times \mathbb{Y}$</span> with <span>$x, y \geq 0$</span>. We use definition (1) to write an ellipse as the root of a quadratic form in homogeneous coordinates:</p><p class="math-container">\[\begin{bmatrix} \xi \\ 1 \end{bmatrix}^T \begin{bmatrix} Q &amp; d \\ d^T &amp; e \end{bmatrix} \begin{bmatrix} \xi \\ 1 \end{bmatrix} = 0\]</p><p>where:</p><p class="math-container">\[\begin{align}
    Q &amp;= D\\
    d &amp;= -D c\\
    e &amp;= c^T D c - r^2
\end{align}\]</p><p>The residual distance <span>$r_0$</span> of a random point <span>$\xi_0 = (x_0, y_0)$</span> to the ellipse is then given by:</p><p class="math-container">\[r_0 \triangleq \begin{bmatrix} \xi_0 \\ 1 \end{bmatrix}^T \begin{bmatrix} Q &amp; d \\ d^T &amp; e \end{bmatrix} \begin{bmatrix} \xi_0 \\ 1 \end{bmatrix}\]</p><p>The value of <span>$r_0$</span> is positive if the point is outside the ellipse, zero if it is on the ellipse and negative if it is inside the ellipse. We also see we only need six parameters to uniquely define an ellipse.</p><h2 id="Helper-functions"><a class="docs-heading-anchor" href="#Helper-functions">Helper functions</a><a id="Helper-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Helper-functions" title="Permalink"></a></h2><p>We define some helper functions to help us visualize the results.</p><pre><code class="language-julia hljs">function plot_dwt(x, sz = (500, 500))
    return Plots.heatmap(
        x;
        color = :grays,
        aspect_ratio = 1,
        cbar = false,
        xlims = (0, size(x, 2)),
        ylims = (0, size(x, 1)),
        size = sz,
        dpi = 300,
    )
end

function normalize(x::AbstractArray)
    l, u = extrema(x)
    return (x .- l) ./ (u - l)
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">normalize (generic function with 1 method)</code></pre><h2 id="Reading-the-test-image"><a class="docs-heading-anchor" href="#Reading-the-test-image">Reading the test image</a><a id="Reading-the-test-image-1"></a><a class="docs-heading-anchor-permalink" href="#Reading-the-test-image" title="Permalink"></a></h2><p>To test our ellipse-fitting algorithm we need a test image with elliptical features. For our test image we will use an image of the cartwheel galaxy, <a href="https://webbtelescope.org/contents/media/images/2022/039/01G8JXN0K2VBQP112RNSQWTCTH">captured by the James Webb Space Telescope</a>. Galaxies <a href="https://science.nasa.gov/universe/galaxies/types/">come in many shapes and sizes</a>, elliptical being one of them.</p><p>This is just a toy problem with little scientific value, but you can imagine how the rotation and position of elliptical galaxies can be useful information to astronomers.</p><pre><code class="language-julia hljs">filename = joinpath(@__DIR__, &quot;..&quot;, &quot;..&quot;, &quot;assets&quot;, &quot;cartwheel_galaxy.png&quot;)
img = Images.load(filename);</code></pre><p>We convert the image to gray scale so that we can work with a single channel.</p><pre><code class="language-julia hljs">img_gray = Images.Gray.(img)
Images.mosaicview(img, img_gray; nrow = 1)</code></pre><img src="8fc1586b.png" alt="Example block output"/><p>Instead of operating on the entire image, we select a region of interest (ROI) which is a subset of <span>$\mathbb{X} \times \mathbb{Y}$</span>.</p><pre><code class="language-julia hljs">sz = 256
X_c = 600
Y_c = 140
X = X_c:(X_c+sz-1)
Y = Y_c:(Y_c+sz-1)
roi = (X, Y)
img_roi = img[roi...]
img_gray_roi = img_gray[roi...]
Images.mosaicview(img_roi, img_gray_roi; nrow = 1)</code></pre><img src="f303a344.png" alt="Example block output"/><h2 id="Extracting-image-features"><a class="docs-heading-anchor" href="#Extracting-image-features">Extracting image features</a><a id="Extracting-image-features-1"></a><a class="docs-heading-anchor-permalink" href="#Extracting-image-features" title="Permalink"></a></h2><p>We cannot directly fit ellipses to the image, so we need to extract features that enable us to find the elliptical galaxies.</p><p>The first step is to find a sparse representation of the image. We will use the discrete wavelet transform (DWT) in combination with the Iterative Shrinking and Thresholding (ISTA) algorithm to denoise the image and find a sparse representation. This will remove redundant information and make it much easier to detect the edges of galaxies.</p><p>Finding a sparse representation amounts to solving the following optimization problem:</p><p class="math-container">\[\min_{x} \frac{1}{2} \left\| y - \Phi x \right\|_2^2 + \lambda \left\| x \right\|_1\]</p><p>where <span>$y$</span> is the noisy image, <span>$\Phi$</span> is the sparsifying basis, <span>$x$</span> is the sparse representation of our image, and <span>$\lambda$</span> is the regularization parameter which we set to <code>0.1</code>.</p><p>To work with our image we must first convert it to Float64.</p><pre><code class="language-julia hljs">x = convert(Array{Float64}, img_gray_roi)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">256×256 Matrix{Float64}:
 0.0823529  0.0588235  0.054902   …  0.0431373  0.0666667  0.054902
 0.0784314  0.0588235  0.054902      0.054902   0.0666667  0.0431373
 0.0705882  0.0666667  0.0627451     0.0588235  0.0705882  0.0588235
 0.0627451  0.0666667  0.0705882     0.054902   0.0627451  0.0627451
 0.0509804  0.0666667  0.0745098     0.0509804  0.0509804  0.0588235
 0.0509804  0.0627451  0.054902   …  0.054902   0.0588235  0.0588235
 0.0588235  0.0784314  0.054902      0.0784314  0.0627451  0.0431373
 0.0627451  0.0509804  0.0509804     0.0666667  0.0588235  0.0666667
 0.0627451  0.0470588  0.054902      0.0470588  0.054902   0.0901961
 0.0588235  0.0509804  0.0470588     0.0470588  0.0470588  0.054902
 ⋮                                ⋱                        ⋮
 0.054902   0.054902   0.0392157     0.054902   0.0666667  0.0745098
 0.0470588  0.054902   0.0509804     0.054902   0.054902   0.0666667
 0.0470588  0.0431373  0.0470588     0.0823529  0.0588235  0.0588235
 0.0470588  0.0509804  0.0431373  …  0.0784314  0.0588235  0.054902
 0.0509804  0.0509804  0.0431373     0.054902   0.0627451  0.054902
 0.0431373  0.0470588  0.0431373     0.054902   0.0705882  0.0666667
 0.0509804  0.0470588  0.0509804     0.0666667  0.0705882  0.0588235
 0.0509804  0.0431373  0.0470588     0.0627451  0.0627451  0.0509804
 0.054902   0.0470588  0.0470588  …  0.0823529  0.0705882  0.0666667</code></pre><p>We then use ISTA in combination with our wavelet sparsifying basis <span>$\Psi$</span> obtained from the <a href="https://en.wikipedia.org/wiki/Daubechies_wavelet">family of Daubechies wavelets</a>. We use the db4 wavelet which has 4 vanishing moments. We set the number of iterations to 15.</p><pre><code class="language-julia hljs">reg = RLS.L1Regularization(0.1);
Φ = LOC.WaveletOp(
    Float64;
    shape = size(x),
    wt = Wavelets.wavelet(Wavelets.WT.db4),
);
solver = RLS.createLinearSolver(RLS.OptISTA, Φ; reg = reg, iterations = 15);</code></pre><p>The sampled image in wavelet domain is given by:</p><pre><code class="language-julia hljs">b = Φ * vec(x);</code></pre><p>We can now solve the optimization problem to find the sparse representation of the image.</p><pre><code class="language-julia hljs">x_approx = RLS.solve!(solver, b)
x_approx = reshape(x_approx, size(x));
x_final = normalize(x_approx)
Images.mosaicview(x, Images.Gray.(x_final); nrow = 1)</code></pre><img src="9b936fa6.png" alt="Example block output"/><p>We then use a binarization algorithm to map each grayscale pixel <span>$(x_i, y_i)$</span> to a binary value so <span>$x_i, y_i \to \{0, 1\}$</span>.</p><pre><code class="language-julia hljs">x_bin = Images.binarize(x_final, Images.Otsu(); nbins = 128)
x_bin = convert(Array{Bool}, x_bin)
plt = plot_dwt(img_roi)
Plots.heatmap!(x_bin; color = :grays, alpha = 0.45)</code></pre><img src="e2d71dfb.svg" alt="Example block output"/><h2 id="Edge-detection-and-clustering"><a class="docs-heading-anchor" href="#Edge-detection-and-clustering">Edge detection and clustering</a><a id="Edge-detection-and-clustering-1"></a><a class="docs-heading-anchor-permalink" href="#Edge-detection-and-clustering" title="Permalink"></a></h2><p>Now that we have our binary image, we can use edge detection to find the edges of the galaxies. We will use the <a href="https://en.wikipedia.org/wiki/Sobel_operator">Sobel operator</a> for this task.</p><pre><code class="language-julia hljs">function edge_detector(
    f_smooth::Matrix{Float64},
    d1::Float64 = 0.1,
    d2::Float64 = 0.1,
)
    rows, cols = size(f_smooth)
    gradient_magnitude = zeros(Float64, rows, cols)
    laplacian_magnitude = zeros(Float64, rows, cols)
    sobel_x = [-1 0 1; -2 0 2; -1 0 1]
    sobel_y = [-1 -2 -1; 0 0 0; 1 2 1]
    sobel_xx = [-1 2 -1; 2 -4 2; -1 2 -1]
    sobel_yy = [-1 2 -1; 2 -4 2; -1 2 -1]
    gradient_x = DSP.conv(f_smooth, sobel_x)
    gradient_y = DSP.conv(f_smooth, sobel_y)
    gradient_magnitude = sqrt.(gradient_x .^ 2 + gradient_y .^ 2)
    gradient_xx = DSP.conv(f_smooth, sobel_xx)
    gradient_yy = DSP.conv(f_smooth, sobel_yy)
    laplacian_magnitude = sqrt.(gradient_xx .^ 2 + gradient_yy .^ 2)
    return (gradient_magnitude .&gt; d1) .&amp; (laplacian_magnitude .&lt; d2)
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">edge_detector (generic function with 3 methods)</code></pre><p>We apply the Sobel operator to the binary image:</p><pre><code class="language-julia hljs">edges = edge_detector(convert(Matrix{Float64}, x_bin), 1e-1, 1e2)
edges = Images.thinning(edges; algo = Images.GuoAlgo())</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">258×258 BitMatrix:
 0  0  0  0  0  0  0  0  0  0  0  0  0  …  0  0  0  0  0  0  0  0  0  0  0  0
 0  0  0  0  0  0  0  0  0  0  0  0  0     0  0  0  0  0  0  0  0  0  0  0  0
 0  0  0  0  0  0  0  0  0  0  0  0  0     0  0  0  0  0  0  0  0  0  0  0  0
 0  0  0  0  0  0  0  0  0  0  0  0  0     0  0  0  0  0  0  0  0  0  0  0  0
 0  0  0  0  0  0  0  0  0  0  0  0  0     0  0  0  0  0  0  0  0  0  0  0  0
 0  0  0  0  0  0  0  0  0  0  0  0  0  …  0  0  0  0  0  0  0  0  0  0  0  0
 0  0  0  0  0  0  0  0  0  0  0  0  0     0  0  0  0  0  0  0  0  0  0  0  0
 0  0  0  0  0  0  0  0  0  0  0  0  0     0  0  0  0  0  0  0  0  0  0  0  0
 0  0  0  0  0  0  0  0  0  0  0  0  0     0  0  0  0  0  0  0  0  0  0  0  0
 0  0  0  0  0  0  0  0  0  0  0  0  0     0  0  0  0  0  0  0  0  0  0  0  0
 ⋮              ⋮              ⋮        ⋱              ⋮              ⋮     
 0  0  0  0  0  0  0  0  0  0  0  0  0     0  0  0  0  0  0  0  0  0  0  0  0
 0  0  0  0  0  0  0  0  0  0  0  0  0  …  0  0  0  0  0  0  0  0  0  0  0  0
 0  0  0  0  0  0  0  0  0  0  0  0  0     0  0  0  0  0  0  0  0  0  0  0  0
 0  0  0  0  0  0  0  0  0  0  0  0  0     0  0  0  0  0  0  0  0  0  0  0  0
 0  0  0  0  0  0  0  0  0  0  0  0  0     0  0  0  0  0  0  0  0  0  0  0  0
 0  0  0  0  0  0  0  0  0  0  0  0  0     0  0  0  0  0  0  0  0  0  0  0  0
 0  0  0  0  0  0  0  0  0  0  0  0  0  …  0  0  0  0  0  0  0  0  0  0  0  0
 0  0  0  0  0  0  0  0  0  0  0  0  0     0  0  0  0  0  0  0  0  0  0  0  0
 0  0  0  0  0  0  0  0  0  0  0  0  0     0  0  0  0  0  0  0  0  0  0  0  0</code></pre><p>And finally we cluster the edges using <code>dbscan</code> so we can fit ellipses to individual galaxies. We can control the minimum size of galaxies by changing the minimum cluster size.</p><pre><code class="language-julia hljs">points = findall(edges)
points = getfield.(points, :I)
points = hcat([p[1] for p in points], [p[2] for p in points])&#39;
result = Clustering.dbscan(
    convert(Matrix{Float64}, points),
    3.0;
    min_neighbors = 2,
    min_cluster_size = 15,
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Clustering.DbscanResult(Clustering.DbscanCluster[Clustering.DbscanCluster(41, [12, 13, 14, 15, 16, 17, 18, 19, 20, 21  …  47, 48, 49, 51, 52, 53, 54, 55, 56, 57], Int64[]), Clustering.DbscanCluster(28, [83, 84, 85, 86, 87, 88, 89, 90, 91, 92  …  102, 105, 106, 107, 108, 109, 110, 111, 112, 113], Int64[]), Clustering.DbscanCluster(17, [121, 122, 125, 126, 127, 130, 131, 134, 135, 138, 139, 144, 145, 146, 147, 148, 149], Int64[]), Clustering.DbscanCluster(26, [152, 153, 154, 155, 156, 157, 158, 159, 160, 161  …  168, 169, 170, 171, 172, 173, 174, 175, 176, 177], Int64[]), Clustering.DbscanCluster(27, [178, 179, 180, 181, 182, 183, 184, 185, 186, 187  …  195, 196, 197, 198, 199, 200, 201, 202, 203, 204], Int64[]), Clustering.DbscanCluster(53, [220, 221, 222, 223, 224, 226, 227, 228, 229, 230  …  297, 298, 301, 302, 303, 304, 305, 308, 309, 310], Int64[]), Clustering.DbscanCluster(62, [237, 238, 239, 245, 246, 247, 248, 249, 256, 257  …  336, 337, 338, 341, 342, 343, 344, 345, 346, 347], Int64[])], [12, 83, 121, 152, 178, 220, 237], [41, 28, 17, 26, 27, 53, 62], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0  …  0, 0, 0, 0, 0, 0, 0, 0, 0, 0])</code></pre><p>The result of the clustering is a list of clusters to which we will assign a unique color. Each cluster is a list of points that belong to the same galaxy.</p><pre><code class="language-julia hljs">clusters = result.clusters
N_clusters = length(clusters)
colors = Plots.distinguishable_colors(N_clusters + 1)[2:end]
plt = plot_dwt(x_final)
for (i, cluster) in enumerate(clusters)
    p_cluster = points[:, cluster.core_indices]
    Plots.scatter!(
        plt,
        p_cluster[2, :],
        p_cluster[1, :];
        color = colors[i],
        label = false,
        markerstrokewidth = 0,
        markersize = 1.5,
    )
end
Plots.plot!(
    plt;
    axis = false,
    legend = :topleft,
    legendcolumns = 1,
    legendfontsize = 12,
)</code></pre><img src="8b76e2e4.svg" alt="Example block output"/><h2 id="Fitting-ellipses"><a class="docs-heading-anchor" href="#Fitting-ellipses">Fitting ellipses</a><a id="Fitting-ellipses-1"></a><a class="docs-heading-anchor-permalink" href="#Fitting-ellipses" title="Permalink"></a></h2><p>Now that we have all the ingredients we can finally start fitting ellipses. We will use a conic optimization approach to do so since it is a very natural way to represent ellipses.</p><p>First, we define the residual distance definition (6) of a point to an ellipse in JuMP:</p><pre><code class="language-julia hljs">function create_ellipse_model(Ξ::Array{Tuple{Int,Int},1}, ϵ = 1e-5)
    N = length(Ξ)
    model = Model(Clarabel.Optimizer)
    set_silent(model)
    @variable(model, Q[1:2, 1:2], PSD)
    @variable(model, d[1:2])
    @variable(model, e)
    @expression(
        model,
        r[i in 1:N],
        [Ξ[i][1], Ξ[i][2], 1]&#39; * [Q d; d&#39; e] * [Ξ[i][1], Ξ[i][2], 1]
    )
    return model
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">create_ellipse_model (generic function with 2 methods)</code></pre><h2 id="Objective-1:-Minimize-the-total-squared-distance"><a class="docs-heading-anchor" href="#Objective-1:-Minimize-the-total-squared-distance">Objective 1: Minimize the total squared distance</a><a id="Objective-1:-Minimize-the-total-squared-distance-1"></a><a class="docs-heading-anchor-permalink" href="#Objective-1:-Minimize-the-total-squared-distance" title="Permalink"></a></h2><p>For our first objective we will minimize the total squared distance of all points to the ellipse. Hence we will use the sum of the squared distances as our objective function, also known as the <span>$L^2$</span> norm:</p><p class="math-container">\[\min_{Q, d, e} P_\text{res}(\mathcal{E}) = \min_{Q, d, e} \sum_{i \in N}
d^2_{\text{res}}(\xi_i, \mathcal{E}) = \min_{Q, d, e} ||d_{\text{res}}||^2_2\]</p><p>This problem is equivalent to:</p><p class="math-container">\[\begin{align}
    \min_{Q, d, e, ζ} &amp;ζ \\
\text{s.t.} \quad ζ \geq d^2_{\text{res}}(\xi_i, \mathcal{E}) &amp;\quad \forall i \in N
\end{align}\]</p><p>And hence can be modelled as a second-order cone program (SOCP) using <a href="../../../moi/reference/standard_form/#MathOptInterface.RotatedSecondOrderCone"><code>MOI.RotatedSecondOrderCone</code></a> as follows:</p><pre><code class="language-julia hljs">ellipses_C1 = Dict{Symbol,Any}[]
for (i, cluster) in enumerate(clusters)
    p_cluster = points[:, cluster.core_indices]
    Ξ = [(point[1], point[2]) for point in eachcol(p_cluster)]
    model = create_ellipse_model(Ξ)
    @variable(model, ζ &gt;= 0)
    @constraint(
        model,
        [1 / 2; ζ; model[:r]] in
        MOI.RotatedSecondOrderCone(2 + length(model[:r]))
    )
    @objective(model, Min, ζ)
    optimize!(model)
    assert_is_solved_and_feasible(model)
    Q, d, e = value.(model[:Q]), value.(model[:d]), value.(model[:e])
    push!(ellipses_C1, Dict(:Q =&gt; Q, :d =&gt; d, :e =&gt; e))
end
W, H = size(img_roi)
x_range = 0:1:W
y_range = 0:1:H
X, Y = [x for x in x_range], [y for y in y_range]
function ellipse_eq(x, y, Q, d, e)
    Z = zeros(length(x), length(y))
    for i in eachindex(x), j in eachindex(y)
        ξ = [x[i], y[j]]
        Z[i, j] = [ξ; 1.0]&#39; * [Q d; d&#39; e] * [ξ; 1.0]
    end
    return Z
end
for ellipse in ellipses_C1
    Q, d, e = ellipse[:Q], ellipse[:d], ellipse[:e]
    Z_sq = ellipse_eq(X, Y, Q, d, e)
    Plots.contour!(
        plt,
        x_range,
        y_range,
        Z_sq;
        levels = [0.0],
        linewidth = 2,
        color = :red,
        cbar = false,
    )
end
plt</code></pre><img src="afba4366.svg" alt="Example block output"/><h2 id="Objective-2:-Minimize-the-maximum-residual-distance"><a class="docs-heading-anchor" href="#Objective-2:-Minimize-the-maximum-residual-distance">Objective 2: Minimize the maximum residual distance</a><a id="Objective-2:-Minimize-the-maximum-residual-distance-1"></a><a class="docs-heading-anchor-permalink" href="#Objective-2:-Minimize-the-maximum-residual-distance" title="Permalink"></a></h2><p>For our second objective we will minimize the maximum residual distance of all points to the ellipse:</p><p class="math-container">\[\min_{Q, d, e} \max_{\xi_i \in \mathcal{F}} d_\text{res}(\xi_i, \mathcal{E}) =
\min_{Q, d, e} ||d_\text{res}||_\infty\]</p><p>This objective can be implemented in JuMP using <a href="../../../moi/reference/standard_form/#MathOptInterface.NormInfinityCone"><code>MOI.NormInfinityCone</code></a> as follows:</p><pre><code class="language-julia hljs">ellipses_C2 = Dict{Symbol,Any}[]
for (i, cluster) in enumerate(clusters)
    p_cluster = points[:, cluster.core_indices]
    Ξ = [(point[1], point[2]) for point in eachcol(p_cluster)]
    model = create_ellipse_model(Ξ)
    N = length(Ξ)
    @variable(model, ζ)
    @constraint(
        model,
        [ζ; model[:r]] in MOI.NormInfinityCone(1 + length(model[:r]))
    )
    @objective(model, Min, ζ)
    optimize!(model)
    assert_is_solved_and_feasible(model; allow_almost = true)
    Q, d, e = value.(model[:Q]), value.(model[:d]), value.(model[:e])
    push!(ellipses_C2, Dict(:Q =&gt; Q, :d =&gt; d, :e =&gt; e))
end
for ellipse in ellipses_C2
    Q, d, e = ellipse[:Q], ellipse[:d], ellipse[:e]
    Z_sq = ellipse_eq(X, Y, Q, d, e)
    Plots.contour!(
        plt,
        x_range,
        y_range,
        Z_sq;
        levels = [0.0],
        linewidth = 2,
        color = :green,
        cbar = false,
    )
end
Plots.scatter!([0], [0]; color = :red, label = &quot;Squared (Obj. 1)&quot;)
Plots.scatter!([0], [0]; color = :green, label = &quot;Min-Max (Obj. 2)&quot;)</code></pre><img src="8864a80f.svg" alt="Example block output"/></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../ellipse_approx/">« Example: ellipsoid approximation</a><a class="docs-footer-nextpage" href="../quantum_discrimination/">Example: quantum state discrimination »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Tuesday 21 October 2025 01:43">Tuesday 21 October 2025</span>. Using Julia version 1.11.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
