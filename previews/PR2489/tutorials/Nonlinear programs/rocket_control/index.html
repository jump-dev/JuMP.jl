<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Rocket Control · JuMP</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-44252521-1', 'auto');
ga('send', 'pageview', {'page': location.pathname + location.search + location.hash});
</script><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../"><img src="../../../assets/logo.png" alt="JuMP logo"/></a><div class="docs-package-name"><span class="docs-autofit">JuMP</span></div><form class="docs-search" action="../../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../../">Introduction</a></li><li><a class="tocitem" href="../../../installation/">Installation Guide</a></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox" checked/><label class="tocitem" for="menuitem-3"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-1" type="checkbox"/><label class="tocitem" for="menuitem-3-1"><span class="docs-label">Getting started</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Getting started/an_introduction_to_julia/">Getting started with Julia</a></li><li><a class="tocitem" href="../../Getting started/getting_started_with_JuMP/">Getting started with JuMP</a></li><li><a class="tocitem" href="../../Getting started/solvers_and_solutions/">Solvers and Solutions</a></li><li><a class="tocitem" href="../../Getting started/variables_constraints_objective/">Variables, constraints, and objective functions</a></li><li><a class="tocitem" href="../../Getting started/working_with_data_files/">Working with Data Files</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-2" type="checkbox"/><label class="tocitem" for="menuitem-3-2"><span class="docs-label">Mixed-integer linear programs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Mixed-integer linear programs/callbacks/">Callbacks</a></li><li><a class="tocitem" href="../../Mixed-integer linear programs/cannery/">The cannery problem</a></li><li><a class="tocitem" href="../../Mixed-integer linear programs/cutting_stock_column_generation/">Cutting stock</a></li><li><a class="tocitem" href="../../Mixed-integer linear programs/diet/">The diet problem</a></li><li><a class="tocitem" href="../../Mixed-integer linear programs/factory_schedule/">The factory schedule example</a></li><li><a class="tocitem" href="../../Mixed-integer linear programs/finance/">Finance</a></li><li><a class="tocitem" href="../../Mixed-integer linear programs/geographic_clustering/">Geographical Clustering</a></li><li><a class="tocitem" href="../../Mixed-integer linear programs/knapsack/">The knapsack problem</a></li><li><a class="tocitem" href="../../Mixed-integer linear programs/multi/">The multi-commodity flow problem</a></li><li><a class="tocitem" href="../../Mixed-integer linear programs/n-queens/">N-Queens</a></li><li><a class="tocitem" href="../../Mixed-integer linear programs/network_flows/">Network Flows</a></li><li><a class="tocitem" href="../../Mixed-integer linear programs/power_systems/">Power Systems</a></li><li><a class="tocitem" href="../../Mixed-integer linear programs/prod/">The workforce scheduling problem</a></li><li><a class="tocitem" href="../../Mixed-integer linear programs/steelT3/">The SteelT3 problem</a></li><li><a class="tocitem" href="../../Mixed-integer linear programs/sudoku/">Sudoku</a></li><li><a class="tocitem" href="../../Mixed-integer linear programs/transp/">The transportation problem</a></li><li><a class="tocitem" href="../../Mixed-integer linear programs/urban_plan/">The urban planning problem</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-3" type="checkbox" checked/><label class="tocitem" for="menuitem-3-3"><span class="docs-label">Nonlinear programs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../clnlbeam/">The clnlbeam problem</a></li><li><a class="tocitem" href="../mle/">Maximum likelihood estimation</a></li><li><a class="tocitem" href="../nlp_tricks/">Nonlinear tips and tricks</a></li><li class="is-active"><a class="tocitem" href>Rocket Control</a><ul class="internal"><li><a class="tocitem" href="#Constants"><span>Constants</span></a></li><li><a class="tocitem" href="#Decision-variables"><span>Decision variables</span></a></li><li><a class="tocitem" href="#Objective"><span>Objective</span></a></li><li><a class="tocitem" href="#Initial-conditions"><span>Initial conditions</span></a></li><li><a class="tocitem" href="#Forces"><span>Forces</span></a></li><li><a class="tocitem" href="#Dynamics-2"><span>Dynamics</span></a></li><li><a class="tocitem" href="#Display-results"><span>Display results</span></a></li></ul></li><li><a class="tocitem" href="../rosenbrock/">The Rosenbrock function</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-4" type="checkbox"/><label class="tocitem" for="menuitem-3-4"><span class="docs-label">Quadratic programs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Quadratic programs/portfolio/">Portfolio Optimization</a></li><li><a class="tocitem" href="../../Quadratic programs/qcp/">Quadratically constrained programs</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-5" type="checkbox"/><label class="tocitem" for="menuitem-3-5"><span class="docs-label">Semidefinite programs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Semidefinite programs/cluster/">K-means clustering via SDP</a></li><li><a class="tocitem" href="../../Semidefinite programs/corr_sdp/">The correlation problem</a></li><li><a class="tocitem" href="../../Semidefinite programs/experiment_design/">Experiment Design</a></li><li><a class="tocitem" href="../../Semidefinite programs/max_cut_sdp/">SDP relaxations: max-cut</a></li><li><a class="tocitem" href="../../Semidefinite programs/min_distortion/">The minimum distortion problem</a></li><li><a class="tocitem" href="../../Semidefinite programs/min_ellipse/">Minimum ellipses</a></li><li><a class="tocitem" href="../../Semidefinite programs/robust_uncertainty/">Robust uncertainty sets</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-6" type="checkbox"/><label class="tocitem" for="menuitem-3-6"><span class="docs-label">Optimization concepts</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Optimization concepts/benders_decomposition/">Benders Decomposition</a></li><li><a class="tocitem" href="../../Optimization concepts/benders_lazy_constraints/">Benders Decomposition (Lazy Constraints)</a></li><li><a class="tocitem" href="../../Optimization concepts/conic_programming/">Conic Programming</a></li><li><a class="tocitem" href="../../Optimization concepts/integer_programming/">Integer Programming</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">Manual</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../manual/models/">Models</a></li><li><a class="tocitem" href="../../../manual/variables/">Variables</a></li><li><a class="tocitem" href="../../../manual/expressions/">Expressions</a></li><li><a class="tocitem" href="../../../manual/objective/">Objectives</a></li><li><a class="tocitem" href="../../../manual/constraints/">Constraints</a></li><li><a class="tocitem" href="../../../manual/containers/">Containers</a></li><li><a class="tocitem" href="../../../manual/solutions/">Solutions</a></li><li><a class="tocitem" href="../../../manual/nlp/">Nonlinear Modeling</a></li><li><a class="tocitem" href="../../../manual/callbacks/">Callbacks</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">API Reference</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../reference/models/">Models</a></li><li><a class="tocitem" href="../../../reference/variables/">Variables</a></li><li><a class="tocitem" href="../../../reference/expressions/">Expressions</a></li><li><a class="tocitem" href="../../../reference/objectives/">Objectives</a></li><li><a class="tocitem" href="../../../reference/constraints/">Constraints</a></li><li><a class="tocitem" href="../../../reference/containers/">Containers</a></li><li><a class="tocitem" href="../../../reference/solutions/">Solutions</a></li><li><a class="tocitem" href="../../../reference/nlp/">Nonlinear Modeling</a></li><li><a class="tocitem" href="../../../reference/callbacks/">Callbacks</a></li><li><a class="tocitem" href="../../../reference/moi/">MathOptInterface</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6" type="checkbox"/><label class="tocitem" for="menuitem-6"><span class="docs-label">Developer Docs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../developers/extensions/">Extensions</a></li><li><a class="tocitem" href="../../../developers/style/">Style Guide</a></li><li><a class="tocitem" href="../../../developers/roadmap/">Roadmap</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li><a class="is-disabled">Nonlinear programs</a></li><li class="is-active"><a href>Rocket Control</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Rocket Control</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/jump-dev/JuMP.jl/blob/master/docs/src/tutorials/Nonlinear programs/rocket_control.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Rocket-Control"><a class="docs-heading-anchor" href="#Rocket-Control">Rocket Control</a><a id="Rocket-Control-1"></a><a class="docs-heading-anchor-permalink" href="#Rocket-Control" title="Permalink"></a></h1><p><strong>Originally Contributed by</strong>: Iain Dunning</p><p>This tutorial shows how to solve a nonlinear rocketry control problem. The problem was drawn from the <a href="http://www.mcs.anl.gov/~more/cops/cops3.pdf">COPS3</a> benchmark.</p><p>Our goal is to maximize the final altitude of a vertically launched rocket.</p><p>We can control the thrust of the rocket, and must take account of the rocket mass, fuel consumption rate, gravity, and aerodynamic drag.</p><p>Let us consider the basic description of the model (for the full description, including parameters for the rocket, see the COPS3 PDF)</p><h3 id="Overview"><a class="docs-heading-anchor" href="#Overview">Overview</a><a id="Overview-1"></a><a class="docs-heading-anchor-permalink" href="#Overview" title="Permalink"></a></h3><p>We will use a discretized model of time, with a fixed number of time steps, <span>$n$</span>.</p><p>We will make the time step size <span>$\Delta t$</span>, and thus the final time <span>$t_f = n \cdot \Delta t$</span>, a variable in the problem. To approximate the derivatives in the problem we will use the <a href="http://en.wikipedia.org/wiki/Trapezoidal_rule">trapezoidal rule</a>.</p><h3 id="State-and-Control"><a class="docs-heading-anchor" href="#State-and-Control">State and Control</a><a id="State-and-Control-1"></a><a class="docs-heading-anchor-permalink" href="#State-and-Control" title="Permalink"></a></h3><p>We will have three state variables:</p><ul><li>Velocity, <span>$v$</span></li><li>Altitude, <span>$h$</span></li><li>Mass of rocket and remaining fuel, <span>$m$</span></li></ul><p>and a single control variable, thrust <span>$T$</span>.</p><p>Our goal is thus to maximize <span>$h(t_f)$</span>.</p><p>Each of these corresponds to a JuMP variable indexed by the time step.</p><h3 id="Dynamics"><a class="docs-heading-anchor" href="#Dynamics">Dynamics</a><a id="Dynamics-1"></a><a class="docs-heading-anchor-permalink" href="#Dynamics" title="Permalink"></a></h3><p>We have three equations that control the dynamics of the rocket:</p><p>Rate of ascent: <span>$h^\prime = v$</span> Acceleration: <span>$v^\prime = \frac{T - D(h,v)}{m} - g(h)$</span> Rate of mass loss: <span>$m^\prime = -\frac{T}{c}$</span></p><p>where drag <span>$D(h,v)$</span> is a function of altitude and velocity, and gravity <span>$g(h)$</span> is a function of altitude.</p><p>These forces are defined as</p><p class="math-container">\[D(h,v) = D_c v^2 exp\left( -h_c \left( \frac{h-h(0)}{h(0)} \right) \right)\]</p><p>and <span>$g(h) = g_0 \left( \frac{h(0)}{h} \right)^2$</span></p><p>The three rate equations correspond to JuMP constraints, and for convenience we will represent the forces with nonlinear expressions.</p><pre><code class="language-julia">using JuMP
import Ipopt</code></pre><p>Create JuMP model, using Ipopt as the solver</p><pre><code class="language-julia">rocket = Model(Ipopt.Optimizer)
set_silent(rocket)</code></pre><pre class="documenter-example-output">true</pre><h2 id="Constants"><a class="docs-heading-anchor" href="#Constants">Constants</a><a id="Constants-1"></a><a class="docs-heading-anchor-permalink" href="#Constants" title="Permalink"></a></h2><p>Note that all parameters in the model have been normalized to be dimensionless. See the COPS3 paper for more info.</p><pre><code class="language-julia">h_0 = 1    # Initial height
v_0 = 0    # Initial velocity
m_0 = 1    # Initial mass
g_0 = 1    # Gravity at the surface

T_c = 3.5  # Used for thrust
h_c = 500  # Used for drag
v_c = 620  # Used for drag
m_c = 0.6  # Fraction of initial mass left at end

c     = 0.5 * sqrt(g_0 * h_0)  # Thrust-to-fuel mass
m_f   = m_c * m_0              # Final mass
D_c   = 0.5 * v_c * m_0 / g_0  # Drag scaling
T_max = T_c * g_0 * m_0        # Maximum thrust

n = 800    # Time steps</code></pre><pre class="documenter-example-output">800</pre><h2 id="Decision-variables"><a class="docs-heading-anchor" href="#Decision-variables">Decision variables</a><a id="Decision-variables-1"></a><a class="docs-heading-anchor-permalink" href="#Decision-variables" title="Permalink"></a></h2><pre><code class="language-julia">@variables(rocket, begin
    Δt ≥ 0, (start = 1/n) # Time step
    # State variables
    v[1:n] ≥ 0            # Velocity
    h[1:n] ≥ h_0          # Height
    m_f ≤ m[1:n] ≤ m_0    # Mass
    # Control variables
    0 ≤ T[1:n] ≤ T_max    # Thrust
end)</code></pre><h2 id="Objective"><a class="docs-heading-anchor" href="#Objective">Objective</a><a id="Objective-1"></a><a class="docs-heading-anchor-permalink" href="#Objective" title="Permalink"></a></h2><p>The objective is to maximize altitude at end of time of flight.</p><pre><code class="language-julia">@objective(rocket, Max, h[n])</code></pre><p class="math-container">\[ h_{800} \]</p><h2 id="Initial-conditions"><a class="docs-heading-anchor" href="#Initial-conditions">Initial conditions</a><a id="Initial-conditions-1"></a><a class="docs-heading-anchor-permalink" href="#Initial-conditions" title="Permalink"></a></h2><pre><code class="language-julia">fix(v[1], v_0; force = true)
fix(h[1], h_0; force = true)
fix(m[1], m_0; force = true)
fix(m[n], m_f; force = true)</code></pre><h2 id="Forces"><a class="docs-heading-anchor" href="#Forces">Forces</a><a id="Forces-1"></a><a class="docs-heading-anchor-permalink" href="#Forces" title="Permalink"></a></h2><pre><code class="language-julia">@NLexpressions(rocket, begin
    # Drag(h,v) = Dc v^2 exp( -hc * (h - h0) / h0 )
    drag[j = 1:n], D_c * (v[j]^2) * exp(-h_c * (h[j] - h_0) / h_0)
    # Grav(h)   = go * (h0 / h)^2
    grav[j = 1:n], g_0 * (h_0 / h[j])^2
    # Time of flight
    t_f, Δt * n
end)</code></pre><h2 id="Dynamics-2"><a class="docs-heading-anchor" href="#Dynamics-2">Dynamics</a><a class="docs-heading-anchor-permalink" href="#Dynamics-2" title="Permalink"></a></h2><pre><code class="language-julia">for j in 2:n
    # h&#39; = v
    # Rectangular integration
    # @NLconstraint(rocket, h[j] == h[j - 1] + Δt * v[j - 1])
    # Trapezoidal integration
    @NLconstraint(rocket, h[j] == h[j - 1] + 0.5 * Δt * (v[j] + v[j - 1]))
    # v&#39; = (T-D(h,v))/m - g(h)
    # Rectangular integration
    # @NLconstraint(
    #     rocket,
    #     v[j] == v[j - 1] + Δt *((T[j - 1] - drag[j - 1]) / m[j - 1] - grav[j - 1])
    # )
    # Trapezoidal integration
    @NLconstraint(
        rocket,
        v[j] == v[j-1] +
            0.5 * Δt * (
                (T[j] - drag[j] - m[j] * grav[j]) / m[j] +
                (T[j - 1] - drag[j - 1] - m[j - 1] * grav[j - 1]) / m[j - 1]
            )
    )
    # m&#39; = -T/c
    # Rectangular integration
    # @NLconstraint(rocket, m[j] == m[j - 1] - Δt * T[j - 1] / c)
    # Trapezoidal integration
    @NLconstraint(rocket, m[j] == m[j - 1] - 0.5 * Δt * (T[j] + T[j-1]) / c)
end</code></pre><p>Solve for the control and state</p><pre><code class="language-julia">println(&quot;Solving...&quot;)
status = optimize!(rocket)</code></pre><pre class="documenter-example-output">Solving...</pre><h2 id="Display-results"><a class="docs-heading-anchor" href="#Display-results">Display results</a><a id="Display-results-1"></a><a class="docs-heading-anchor-permalink" href="#Display-results" title="Permalink"></a></h2><pre><code class="language-julia">println(&quot;Max height: &quot;, objective_value(rocket))</code></pre><pre class="documenter-example-output">Max height: 1.0128340648308016</pre><pre><code class="language-julia"># Uncomment these to visualize the trajectory.
# Can visualize the state and control variables
# using Gadfly
# h_plot = plot(x = (1:n) * value.(Δt), y = value.(h)[:], Geom.line,
#                 Guide.xlabel(&quot;Time (s)&quot;), Guide.ylabel(&quot;Altitude&quot;))
# m_plot = plot(x = (1:n) * value.(Δt), y = value.(m)[:], Geom.line,
#                 Guide.xlabel(&quot;Time (s)&quot;), Guide.ylabel(&quot;Mass&quot;))
# v_plot = plot(x = (1:n) * value.(Δt), y = value.(v)[:], Geom.line,
#                 Guide.xlabel(&quot;Time (s)&quot;), Guide.ylabel(&quot;Velocity&quot;))
# T_plot = plot(x = (1:n) * value.(Δt), y = value.(T)[:], Geom.line,
#                 Guide.xlabel(&quot;Time (s)&quot;), Guide.ylabel(&quot;Thrust&quot;))
# draw(SVG(6inch, 6inch), vstack(hstack(h_plot, m_plot), hstack(v_plot, T_plot)))</code></pre><p><a href="https://github.com/jump-dev/JuMP.jl/blob/master/docs/src/tutorials/Nonlinear programs/rocket_control.jl">View this file on Github</a>.</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../nlp_tricks/">« Nonlinear tips and tricks</a><a class="docs-footer-nextpage" href="../rosenbrock/">The Rosenbrock function »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 22 February 2021 00:47">Monday 22 February 2021</span>. Using Julia version 1.0.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
