<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Writing a solver interface · JuMP</title><meta name="title" content="Writing a solver interface · JuMP"/><meta property="og:title" content="Writing a solver interface · JuMP"/><meta property="twitter:title" content="Writing a solver interface · JuMP"/><meta name="description" content="Documentation for JuMP."/><meta property="og:description" content="Documentation for JuMP."/><meta property="twitter:description" content="Documentation for JuMP."/><script async src="https://www.googletagmanager.com/gtag/js?id=G-0RZ8X3D3D0"></script><script>  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-0RZ8X3D3D0', {'page_path': location.pathname + location.search + location.hash});
</script><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../search_index.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script><link href="../../../assets/extra_styles.css" rel="stylesheet" type="text/css"/><link href="../../../assets/citations.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../"><img class="docs-light-only" src="../../../assets/logo.svg" alt="JuMP logo"/><img class="docs-dark-only" src="../../../assets/logo-dark.svg" alt="JuMP logo"/></a><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><input class="collapse-toggle" id="menuitem-1" type="checkbox"/><label class="tocitem" for="menuitem-1"><span class="docs-label">Introduction</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../">Introduction</a></li><li><a class="tocitem" href="../../../should_i_use/">Should you use JuMP?</a></li><li><a class="tocitem" href="../../../installation/">Installation Guide</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox" checked/><label class="tocitem" for="menuitem-2"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-2-1" type="checkbox"/><label class="tocitem" for="menuitem-2-1"><span class="docs-label">Getting started</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../getting_started/introduction/">Introduction</a></li><li><a class="tocitem" href="../../getting_started/getting_started_with_julia/">Getting started with Julia</a></li><li><a class="tocitem" href="../../getting_started/getting_started_with_JuMP/">Getting started with JuMP</a></li><li><a class="tocitem" href="../../getting_started/getting_started_with_sets_and_indexing/">Getting started with sets and indexing</a></li><li><a class="tocitem" href="../../getting_started/getting_started_with_data_and_plotting/">Getting started with data and plotting</a></li><li><a class="tocitem" href="../../getting_started/debugging/">Debugging</a></li><li><a class="tocitem" href="../../getting_started/tolerances/">Tolerances and numerical issues</a></li><li><a class="tocitem" href="../../getting_started/design_patterns_for_larger_models/">Design patterns for larger models</a></li><li><a class="tocitem" href="../../getting_started/performance_tips/">Performance tips</a></li><li><a class="tocitem" href="../../getting_started/sum_if/">Performance problems with sum-if formulations</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-2" type="checkbox"/><label class="tocitem" for="menuitem-2-2"><span class="docs-label">Transitioning</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../transitioning/transitioning_from_matlab/">Transitioning from MATLAB</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-3" type="checkbox"/><label class="tocitem" for="menuitem-2-3"><span class="docs-label">Linear programs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../linear/introduction/">Introduction</a></li><li><a class="tocitem" href="../../linear/knapsack/">The knapsack problem example</a></li><li><a class="tocitem" href="../../linear/diet/">The diet problem</a></li><li><a class="tocitem" href="../../linear/cannery/">The cannery problem</a></li><li><a class="tocitem" href="../../linear/factory_schedule/">The factory schedule example</a></li><li><a class="tocitem" href="../../linear/multi/">The multi-commodity flow problem</a></li><li><a class="tocitem" href="../../linear/multi_commodity_network/">The network multi-commodity flow problem</a></li><li><a class="tocitem" href="../../linear/tips_and_tricks/">Tips and tricks</a></li><li><a class="tocitem" href="../../linear/piecewise_linear/">Approximating nonlinear functions</a></li><li><a class="tocitem" href="../../linear/facility_location/">The facility location problem</a></li><li><a class="tocitem" href="../../linear/finance/">Financial modeling problems</a></li><li><a class="tocitem" href="../../linear/geographic_clustering/">Geographical clustering</a></li><li><a class="tocitem" href="../../linear/network_flows/">Network flow problems</a></li><li><a class="tocitem" href="../../linear/transp/">The transportation problem</a></li><li><a class="tocitem" href="../../linear/multi_objective_knapsack/">Multi-objective knapsack</a></li><li><a class="tocitem" href="../../linear/multi_objective_examples/">Simple multi-objective examples</a></li><li><a class="tocitem" href="../../linear/sudoku/">Sudoku</a></li><li><a class="tocitem" href="../../linear/n-queens/">N-Queens</a></li><li><a class="tocitem" href="../../linear/constraint_programming/">Constraint programming</a></li><li><a class="tocitem" href="../../linear/callbacks/">Callbacks</a></li><li><a class="tocitem" href="../../linear/lp_sensitivity/">Sensitivity analysis of a linear program</a></li><li><a class="tocitem" href="../../linear/basis/">Basis matrices</a></li><li><a class="tocitem" href="../../linear/mip_duality/">Computing the duals of a mixed-integer program</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-4" type="checkbox"/><label class="tocitem" for="menuitem-2-4"><span class="docs-label">Nonlinear programs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../nonlinear/introduction/">Introduction</a></li><li><a class="tocitem" href="../../nonlinear/simple_examples/">Simple examples</a></li><li><a class="tocitem" href="../../nonlinear/tips_and_tricks/">User-defined operators with vector outputs</a></li><li><a class="tocitem" href="../../nonlinear/operator_ad/">Automatic differentiation of user-defined operators</a></li><li><a class="tocitem" href="../../nonlinear/user_defined_hessians/">User-defined Hessians</a></li><li><a class="tocitem" href="../../nonlinear/nested_problems/">Nested optimization problems</a></li><li><a class="tocitem" href="../../nonlinear/querying_hessians/">Computing Hessians</a></li><li><a class="tocitem" href="../../nonlinear/complementarity/">Example: mixed complementarity problems</a></li><li><a class="tocitem" href="../../nonlinear/classifiers/">Example: classification problems</a></li><li><a class="tocitem" href="../../nonlinear/portfolio/">Example: portfolio optimization</a></li><li><a class="tocitem" href="../../nonlinear/rocket_control/">Example: nonlinear optimal control of a rocket</a></li><li><a class="tocitem" href="../../nonlinear/space_shuttle_reentry_trajectory/">Example: optimal control for a Space Shuttle reentry trajectory</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-5" type="checkbox"/><label class="tocitem" for="menuitem-2-5"><span class="docs-label">Conic programs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../conic/introduction/">Introduction</a></li><li><a class="tocitem" href="../../conic/tips_and_tricks/">Modeling with cones</a></li><li><a class="tocitem" href="../../conic/dualization/">Dualization</a></li><li><a class="tocitem" href="../../conic/arbitrary_precision/">Arbitrary precision arithmetic</a></li><li><a class="tocitem" href="../../conic/start_values/">Primal and dual warm-starts</a></li><li><a class="tocitem" href="../../conic/simple_examples/">Simple semidefinite programming examples</a></li><li><a class="tocitem" href="../../conic/logistic_regression/">Example: logistic regression</a></li><li><a class="tocitem" href="../../conic/experiment_design/">Example: experiment design</a></li><li><a class="tocitem" href="../../conic/min_ellipse/">Example: minimal ellipses</a></li><li><a class="tocitem" href="../../conic/ellipse_approx/">Example: ellipsoid approximation</a></li><li><a class="tocitem" href="../../conic/quantum_discrimination/">Example: quantum state discrimination</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-6" type="checkbox" checked/><label class="tocitem" for="menuitem-2-6"><span class="docs-label">Algorithms</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../benders_decomposition/">Benders decomposition</a></li><li><a class="tocitem" href="../cutting_stock_column_generation/">Column generation</a></li><li><a class="tocitem" href="../tsp_lazy_constraints/">Traveling Salesperson Problem</a></li><li><a class="tocitem" href="../rolling_horizon/">Rolling horizon problems</a></li><li><a class="tocitem" href="../parallelism/">Parallelism</a></li><li class="is-active"><a class="tocitem" href>Writing a solver interface</a><ul class="internal"><li><a class="tocitem" href="#Required-packages"><span>Required packages</span></a></li><li><a class="tocitem" href="#Primal-Dual-Hybrid-Gradient"><span>Primal Dual Hybrid Gradient</span></a></li><li><a class="tocitem" href="#The-MOI-interface"><span>The MOI interface</span></a></li><li><a class="tocitem" href="#Solutions"><span>Solutions</span></a></li><li><a class="tocitem" href="#A-JuMP-example"><span>A JuMP example</span></a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-7" type="checkbox"/><label class="tocitem" for="menuitem-2-7"><span class="docs-label">Applications</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../applications/power_systems/">Power Systems</a></li><li><a class="tocitem" href="../../applications/optimal_power_flow/">Optimal power flow</a></li><li><a class="tocitem" href="../../applications/web_app/">Serving web apps</a></li><li><a class="tocitem" href="../../applications/two_stage_stochastic/">Two-stage stochastic programs</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">Manual</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../manual/models/">Models</a></li><li><a class="tocitem" href="../../../manual/variables/">Variables</a></li><li><a class="tocitem" href="../../../manual/constraints/">Constraints</a></li><li><a class="tocitem" href="../../../manual/expressions/">Expressions</a></li><li><a class="tocitem" href="../../../manual/objective/">Objectives</a></li><li><a class="tocitem" href="../../../manual/containers/">Containers</a></li><li><a class="tocitem" href="../../../manual/solutions/">Solutions</a></li><li><a class="tocitem" href="../../../manual/callbacks/">Solver-independent Callbacks</a></li><li><a class="tocitem" href="../../../manual/complex/">Complex number support</a></li><li><a class="tocitem" href="../../../manual/nonlinear/">Nonlinear Modeling</a></li><li><a class="tocitem" href="../../../manual/nlp/">Nonlinear Modeling (Legacy)</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">API Reference</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../api/JuMP/">JuMP</a></li><li><a class="tocitem" href="../../../api/JuMP.Containers/">JuMP.Containers</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">Background Information</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../background/algebraic_modeling_languages/">Algebraic modeling languages</a></li><li><a class="tocitem" href="../../../background/bibliography/">Bibliography</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6" type="checkbox"/><label class="tocitem" for="menuitem-6"><span class="docs-label">Developer Docs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../developers/contributing/">Contributing</a></li><li><a class="tocitem" href="../../../developers/extensions/">Extensions</a></li><li><a class="tocitem" href="../../../developers/custom_solver_binaries/">Custom binaries</a></li><li><a class="tocitem" href="../../../developers/style/">Style Guide</a></li><li><a class="tocitem" href="../../../developers/roadmap/">Roadmap</a></li><li><a class="tocitem" href="../../../developers/checklists/">Checklists</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-7" type="checkbox"/><label class="tocitem" for="menuitem-7"><span class="docs-label">Solvers</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../packages/solvers/">Introduction</a></li><li><a class="tocitem" href="../../../packages/AmplNLWriter/">jump-dev/AmplNLWriter.jl</a></li><li><a class="tocitem" href="../../../packages/BARON/">jump-dev/BARON.jl</a></li><li><a class="tocitem" href="../../../packages/CPLEX/">jump-dev/CPLEX.jl</a></li><li><a class="tocitem" href="../../../packages/CSDP/">jump-dev/CSDP.jl</a></li><li><a class="tocitem" href="../../../packages/Cbc/">jump-dev/Cbc.jl</a></li><li><a class="tocitem" href="../../../packages/Clp/">jump-dev/Clp.jl</a></li><li><a class="tocitem" href="../../../packages/DSDP/">jump-dev/DSDP.jl</a></li><li><a class="tocitem" href="../../../packages/Dualization/">jump-dev/Dualization.jl</a></li><li><a class="tocitem" href="../../../packages/ECOS/">jump-dev/ECOS.jl</a></li><li><a class="tocitem" href="../../../packages/GLPK/">jump-dev/GLPK.jl</a></li><li><a class="tocitem" href="../../../packages/Gurobi/">jump-dev/Gurobi.jl</a></li><li><a class="tocitem" href="../../../packages/HiGHS/">jump-dev/HiGHS.jl</a></li><li><a class="tocitem" href="../../../packages/Hypatia/">jump-dev/Hypatia.jl</a></li><li><a class="tocitem" href="../../../packages/Ipopt/">jump-dev/Ipopt.jl</a></li><li><a class="tocitem" href="../../../packages/KNITRO/">jump-dev/KNITRO.jl</a></li><li><a class="tocitem" href="../../../packages/MiniZinc/">jump-dev/MiniZinc.jl</a></li><li><a class="tocitem" href="../../../packages/MosekTools/">jump-dev/MosekTools.jl</a></li><li><a class="tocitem" href="../../../packages/MultiObjectiveAlgorithms/">jump-dev/MultiObjectiveAlgorithms.jl</a></li><li><a class="tocitem" href="../../../packages/NEOSServer/">jump-dev/NEOSServer.jl</a></li><li><a class="tocitem" href="../../../packages/NLopt/">jump-dev/NLopt.jl</a></li><li><a class="tocitem" href="../../../packages/Pajarito/">jump-dev/Pajarito.jl</a></li><li><a class="tocitem" href="../../../packages/Pavito/">jump-dev/Pavito.jl</a></li><li><a class="tocitem" href="../../../packages/SCS/">jump-dev/SCS.jl</a></li><li><a class="tocitem" href="../../../packages/SDPA/">jump-dev/SDPA.jl</a></li><li><a class="tocitem" href="../../../packages/SDPLR/">jump-dev/SDPLR.jl</a></li><li><a class="tocitem" href="../../../packages/SDPNAL/">jump-dev/SDPNAL.jl</a></li><li><a class="tocitem" href="../../../packages/SDPT3/">jump-dev/SDPT3.jl</a></li><li><a class="tocitem" href="../../../packages/SeDuMi/">jump-dev/SeDuMi.jl</a></li><li><a class="tocitem" href="../../../packages/Xpress/">jump-dev/Xpress.jl</a></li><li><a class="tocitem" href="../../../packages/COPT/">COPT-Public/COPT.jl</a></li><li><a class="tocitem" href="../../../packages/GAMS/">GAMS-dev/GAMS.jl</a></li><li><a class="tocitem" href="../../../packages/Manopt/">JuliaManifolds/Manopt.jl</a></li><li><a class="tocitem" href="../../../packages/Optim/">JuliaNLSolvers/Optim.jl</a></li><li><a class="tocitem" href="../../../packages/CDDLib/">JuliaPolyhedra/CDDLib.jl</a></li><li><a class="tocitem" href="../../../packages/Percival/">JuliaSmoothOptimizers/Percival.jl</a></li><li><a class="tocitem" href="../../../packages/MAiNGO/">MAiNGO-github/MAiNGO.jl</a></li><li><a class="tocitem" href="../../../packages/MadNLP/">MadNLP/MadNLP.jl</a></li><li><a class="tocitem" href="../../../packages/EAGO/">PSORLab/EAGO.jl</a></li><li><a class="tocitem" href="../../../packages/PATHSolver/">chkwon/PATHSolver.jl</a></li><li><a class="tocitem" href="../../../packages/DAQP/">darnstrom/DAQP.jl</a></li><li><a class="tocitem" href="../../../packages/Tulip/">ds4dm/Tulip.jl</a></li><li><a class="tocitem" href="../../../packages/Loraine/">kocvara/Loraine.jl</a></li><li><a class="tocitem" href="../../../packages/Alpine/">lanl-ansi/Alpine.jl</a></li><li><a class="tocitem" href="../../../packages/Juniper/">lanl-ansi/Juniper.jl</a></li><li><a class="tocitem" href="../../../packages/ProxSDP/">mariohsouto/ProxSDP.jl</a></li><li><a class="tocitem" href="../../../packages/OSQP/">osqp/OSQP.jl</a></li><li><a class="tocitem" href="../../../packages/CDCS/">oxfordcontrol/CDCS.jl</a></li><li><a class="tocitem" href="../../../packages/COSMO/">oxfordcontrol/COSMO.jl</a></li><li><a class="tocitem" href="../../../packages/Clarabel/">oxfordcontrol/Clarabel.jl</a></li><li><a class="tocitem" href="../../../packages/SCIP/">scipopt/SCIP.jl</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-8" type="checkbox"/><label class="tocitem" for="menuitem-8"><span class="docs-label">Extensions</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../extensions/introduction/">Introduction</a></li><li><a class="tocitem" href="../../../packages/DiffOpt/">jump-dev/DiffOpt.jl</a></li><li><a class="tocitem" href="../../../packages/ParametricOptInterface/">jump-dev/ParametricOptInterface.jl</a></li><li><a class="tocitem" href="../../../packages/PiecewiseLinearOpt/">jump-dev/PiecewiseLinearOpt.jl</a></li><li><a class="tocitem" href="../../../packages/PolyJuMP/">jump-dev/PolyJuMP.jl</a></li><li><a class="tocitem" href="../../../packages/SumOfSquares/">jump-dev/SumOfSquares.jl</a></li><li><a class="tocitem" href="../../../packages/DisjunctiveProgramming/">hdavid16/DisjunctiveProgramming.jl</a></li><li><a class="tocitem" href="../../../packages/InfiniteOpt/">infiniteopt/InfiniteOpt.jl</a></li><li><a class="tocitem" href="../../../packages/BilevelJuMP/">joaquimg/BilevelJuMP.jl</a></li><li><a class="tocitem" href="../../../packages/MathOptAI/">lanl-ansi/MathOptAI.jl</a></li><li><a class="tocitem" href="../../../packages/MathOptSymbolicAD/">lanl-ansi/MathOptSymbolicAD.jl</a></li><li><a class="tocitem" href="../../../packages/SDDP/">odow/SDDP.jl</a></li><li><a class="tocitem" href="../../../packages/Plasmo/">plasmo-dev/Plasmo.jl</a></li><li><a class="tocitem" href="../../../extensions/DimensionalData/">rafaqz/DimensionalData.jl</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-9" type="checkbox"/><label class="tocitem" for="menuitem-9"><span class="docs-label">MathOptInterface</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-9-1" type="checkbox"/><label class="tocitem" for="menuitem-9-1"><span class="docs-label">Introduction</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../moi/">Introduction</a></li><li><a class="tocitem" href="../../../moi/background/motivation/">Motivation</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-9-2" type="checkbox"/><label class="tocitem" for="menuitem-9-2"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../moi/tutorials/example/">Solving a problem using MathOptInterface</a></li><li><a class="tocitem" href="../../../moi/tutorials/implementing/">Implementing a solver interface</a></li><li><a class="tocitem" href="../../../moi/tutorials/mathprogbase/">Transitioning from MathProgBase</a></li><li><a class="tocitem" href="../../../moi/tutorials/bridging_constraint/">Implementing a constraint bridge</a></li><li><a class="tocitem" href="../../../moi/tutorials/manipulating_expressions/">Manipulating expressions</a></li><li><a class="tocitem" href="../../../moi/tutorials/latency/">Latency</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-9-3" type="checkbox"/><label class="tocitem" for="menuitem-9-3"><span class="docs-label">Manual</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../moi/manual/standard_form/">Standard form problem</a></li><li><a class="tocitem" href="../../../moi/manual/models/">Models</a></li><li><a class="tocitem" href="../../../moi/manual/variables/">Variables</a></li><li><a class="tocitem" href="../../../moi/manual/constraints/">Constraints</a></li><li><a class="tocitem" href="../../../moi/manual/solutions/">Solutions</a></li><li><a class="tocitem" href="../../../moi/manual/modification/">Problem modification</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-9-4" type="checkbox"/><label class="tocitem" for="menuitem-9-4"><span class="docs-label">Background</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../moi/background/duality/">Duality</a></li><li><a class="tocitem" href="../../../moi/background/infeasibility_certificates/">Infeasibility certificates</a></li><li><a class="tocitem" href="../../../moi/background/naming_conventions/">Naming conventions</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-9-5" type="checkbox"/><label class="tocitem" for="menuitem-9-5"><span class="docs-label">API Reference</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../moi/reference/standard_form/">Standard form</a></li><li><a class="tocitem" href="../../../moi/reference/models/">Models</a></li><li><a class="tocitem" href="../../../moi/reference/variables/">Variables</a></li><li><a class="tocitem" href="../../../moi/reference/constraints/">Constraints</a></li><li><a class="tocitem" href="../../../moi/reference/modification/">Modifications</a></li><li><a class="tocitem" href="../../../moi/reference/nonlinear/">Nonlinear programming</a></li><li><a class="tocitem" href="../../../moi/reference/callbacks/">Callbacks</a></li><li><a class="tocitem" href="../../../moi/reference/errors/">Errors</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-9-6" type="checkbox"/><label class="tocitem" for="menuitem-9-6"><span class="docs-label">Submodules</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-9-6-1" type="checkbox"/><label class="tocitem" for="menuitem-9-6-1"><span class="docs-label">Benchmarks</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../moi/submodules/Benchmarks/overview/">Overview</a></li><li><a class="tocitem" href="../../../moi/submodules/Benchmarks/reference/">API Reference</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-9-6-2" type="checkbox"/><label class="tocitem" for="menuitem-9-6-2"><span class="docs-label">Bridges</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../moi/submodules/Bridges/overview/">Overview</a></li><li><a class="tocitem" href="../../../moi/submodules/Bridges/implementation/">Implementation</a></li><li><a class="tocitem" href="../../../moi/submodules/Bridges/list_of_bridges/">List of bridges</a></li><li><a class="tocitem" href="../../../moi/submodules/Bridges/reference/">API Reference</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-9-6-3" type="checkbox"/><label class="tocitem" for="menuitem-9-6-3"><span class="docs-label">FileFormats</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../moi/submodules/FileFormats/overview/">Overview</a></li><li><a class="tocitem" href="../../../moi/submodules/FileFormats/reference/">API Reference</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-9-6-4" type="checkbox"/><label class="tocitem" for="menuitem-9-6-4"><span class="docs-label">Nonlinear</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../moi/submodules/Nonlinear/overview/">Overview</a></li><li><a class="tocitem" href="../../../moi/submodules/Nonlinear/reference/">API Reference</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-9-6-5" type="checkbox"/><label class="tocitem" for="menuitem-9-6-5"><span class="docs-label">Utilities</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../moi/submodules/Utilities/overview/">Overview</a></li><li><a class="tocitem" href="../../../moi/submodules/Utilities/reference/">API Reference</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-9-6-6" type="checkbox"/><label class="tocitem" for="menuitem-9-6-6"><span class="docs-label">Test</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../moi/submodules/Test/overview/">Overview</a></li><li><a class="tocitem" href="../../../moi/submodules/Test/reference/">API Reference</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-9-7" type="checkbox"/><label class="tocitem" for="menuitem-9-7"><span class="docs-label">Developer Docs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../moi/developer/checklists/">Checklists</a></li></ul></li><li><a class="tocitem" href="../../../moi/release_notes/">Release notes</a></li></ul></li><li><a class="tocitem" href="../../../release_notes/">Release notes</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li><a class="is-disabled">Algorithms</a></li><li class="is-active"><a href>Writing a solver interface</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Writing a solver interface</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/jump-dev/JuMP.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/jump-dev/JuMP.jl/blob/master/docs/src/tutorials/algorithms/pdhg.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Writing-a-solver-interface"><a class="docs-heading-anchor" href="#Writing-a-solver-interface">Writing a solver interface</a><a id="Writing-a-solver-interface-1"></a><a class="docs-heading-anchor-permalink" href="#Writing-a-solver-interface" title="Permalink"></a></h1><p><em>This tutorial was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em> <a href="../pdhg.jl"><em>Download the source as a <code>.jl</code> file</em></a>.</p><p>The purpose of this tutorial is to demonstrate how to implement a basic solver interface to MathOptInterface. As a motivating example, we implement the Primal Dual Hybrid Gradient (PDHG) method. PDHG is a first-order method that can solve convex optimization problems.</p><p>Google has a <a href="https://developers.google.com/optimization/lp/pdlp_math">good introduction to the math behind PDLP</a>, which is a variant of PDHG specialized for linear programs.</p><h2 id="Required-packages"><a class="docs-heading-anchor" href="#Required-packages">Required packages</a><a id="Required-packages-1"></a><a class="docs-heading-anchor-permalink" href="#Required-packages" title="Permalink"></a></h2><p>This tutorial requires the following packages:</p><pre><code class="language-julia hljs">using JuMP
import LinearAlgebra
import MathOptInterface as MOI
import Printf
import SparseArrays</code></pre><h2 id="Primal-Dual-Hybrid-Gradient"><a class="docs-heading-anchor" href="#Primal-Dual-Hybrid-Gradient">Primal Dual Hybrid Gradient</a><a id="Primal-Dual-Hybrid-Gradient-1"></a><a class="docs-heading-anchor-permalink" href="#Primal-Dual-Hybrid-Gradient" title="Permalink"></a></h2><p>The following function is a pedagogical implementation of PDHG that solves the linear program:</p><p class="math-container">\[\begin{aligned}
\text{min}        \ &amp; c^\top x   \\
\text{subject to} \ &amp; Ax = b     \\
                    &amp; x \ge 0.
\end{aligned}\]</p><p>Note that this implementation is intentionally kept simple. It is not robust nor efficient, and it does not incorporate the theoretical improvements in the PDLP paper. It does use two workspace vectors so that the body of the iteration loop is non-allocating.</p><pre><code class="language-julia hljs">function solve_pdhg(
    A::SparseArrays.SparseMatrixCSC{Float64,Int},
    b::Vector{Float64},
    c::Vector{Float64};
    maximum_iterations::Int = 100_000,
    tol::Float64 = 1e-4,
    verbose::Bool = true,
    log_frequency::Int = 1_000,
)
    printf(x::Float64) = Printf.@sprintf(&quot;% 1.6e&quot;, x)
    printf(x::Int) = Printf.@sprintf(&quot;%6d&quot;, x)
    m, n = size(A)
    η = τ = 1 / LinearAlgebra.norm(A) - 1e-6
    x, x_next, y, k, status = zeros(n), zeros(n), zeros(m), 0, MOI.OTHER_ERROR
    m_workspace, n_workspace = zeros(m), zeros(n)
    if verbose
        println(
            &quot;  iter      pobj          dobj         pfeas         dfeas       objfeas&quot;,
        )
    end
    while status == MOI.OTHER_ERROR
        k += 1
        # =====================================================================
        # This block computes x_next = max.(0.0, x - η * (A&#39; * y + c))
        LinearAlgebra.mul!(x_next, A&#39;, y)
        LinearAlgebra.axpby!(-η, c, -η, x_next)
        x_next .+= x
        x_next .= max.(0.0, x_next)
        # =====================================================================
        # This block computes y += τ * (A * (2 * x_next - x) - b)
        copy!(n_workspace, x_next)
        LinearAlgebra.axpby!(-1.0, x, 2.0, n_workspace)
        LinearAlgebra.mul!(y, A, n_workspace, τ, 1.0)
        LinearAlgebra.axpy!(-τ, b, y)
        # =====================================================================
        copy!(x, x_next)
        # =====================================================================
        # This block computes pfeas = LinearAlgebra.norm(A * x - b)
        LinearAlgebra.mul!(m_workspace, A, x)
        m_workspace .-= b
        pfeas = LinearAlgebra.norm(m_workspace)
        # =====================================================================
        # This block computes dfeas = LinearAlgebra.norm(min.(0.0, A&#39; * y + c))
        LinearAlgebra.mul!(n_workspace, A&#39;, y)
        n_workspace .+= c
        n_workspace .= min.(0.0, n_workspace)
        dfeas = LinearAlgebra.norm(n_workspace)
        # =====================================================================
        objfeas = abs(LinearAlgebra.dot(c, x) + LinearAlgebra.dot(b, y))
        if pfeas &lt;= tol &amp;&amp; dfeas &lt;= tol &amp;&amp; objfeas &lt;= tol
            status = MOI.OPTIMAL
        elseif k == maximum_iterations
            status = MOI.ITERATION_LIMIT
        end
        if verbose &amp;&amp; (mod(k, log_frequency) == 0 || status != MOI.OTHER_ERROR)
            logs = printf.((k, c&#39; * x, -b&#39; * y, pfeas, dfeas, objfeas))
            println(join(logs, &quot; &quot;))
        end
    end
    return status, k, x, y
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">solve_pdhg (generic function with 1 method)</code></pre><p>Here&#39;s an example:</p><pre><code class="language-julia hljs">A = [0.0 -1.0 -1.0 0.0 0.0; 6.0 8.0 0.0 -1.0 0.0; 7.0 12.0 0.0 0.0 -1.0]
b = [-3.0, 100.0, 120.0]
c = [12.0, 20.0, 0.0, 0.0, 0.0]
status, k, x, y = solve_pdhg(SparseArrays.sparse(A), b, c);</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">  iter      pobj          dobj         pfeas         dfeas       objfeas
  1000  2.050187e+02  2.044002e+02  2.006420e-01  2.674295e-02  6.185366e-01
  2000  2.049895e+02  2.051241e+02  1.705136e-02  2.746207e-02  1.346232e-01
  3000  2.050050e+02  2.050805e+02  8.907061e-03  8.405470e-03  7.550812e-02
  4000  2.050024e+02  2.049755e+02  4.046623e-03  9.374982e-04  2.689079e-02
  5000  2.049995e+02  2.049831e+02  8.635908e-04  6.483234e-04  1.633722e-02
  6000  2.049995e+02  2.050016e+02  7.833794e-04  1.676266e-04  2.095135e-03
  7000  2.050000e+02  2.050030e+02  2.811341e-05  3.065459e-04  2.964863e-03
  8000  2.050001e+02  2.050002e+02  1.316682e-04  1.674879e-05  8.453982e-05
  8365  2.049999e+02  2.050000e+02  9.473351e-05  2.381905e-06  7.955573e-05</code></pre><p>The termination status is:</p><pre><code class="language-julia hljs">status</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">OPTIMAL::TerminationStatusCode = 1</code></pre><p>The solve took the following number of iterations:</p><pre><code class="language-julia hljs">k</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">8365</code></pre><p>The primal solution is:</p><pre><code class="language-julia hljs">x</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">5-element Vector{Float64}:
 15.000070735249105
  1.2499547393201815
  1.750098059200116
  0.0
  0.0</code></pre><p>The dual multipliers are:</p><pre><code class="language-julia hljs">y</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">3-element Vector{Float64}:
  1.931930909998547e-6
 -0.2500022801722057
 -1.4999982446009117</code></pre><h2 id="The-MOI-interface"><a class="docs-heading-anchor" href="#The-MOI-interface">The MOI interface</a><a id="The-MOI-interface-1"></a><a class="docs-heading-anchor-permalink" href="#The-MOI-interface" title="Permalink"></a></h2><p>Converting a linear program from the modeler&#39;s form into the <code>A</code>, <code>b</code>, and <code>c</code> matrices of the standard form required by our implementation of PDHG is tedious and error-prone. This section walks through how to implement a basic interface to MathOptInterface, so that we can use our algorithm from JuMP.</p><p>For a more comprehensive guide, see <a href="../../../moi/tutorials/implementing/#Implementing-a-solver-interface">Implementing a solver interface</a>.</p><h3 id="The-Optimizer-type"><a class="docs-heading-anchor" href="#The-Optimizer-type">The Optimizer type</a><a id="The-Optimizer-type-1"></a><a class="docs-heading-anchor-permalink" href="#The-Optimizer-type" title="Permalink"></a></h3><p>Create an optimizer by subtyping <a href="../../../moi/reference/models/#MathOptInterface.AbstractOptimizer"><code>MOI.AbstractOptimizer</code></a>. By convention, the name of this type is <code>Optimizer</code>, and most optimizers are available as <code>PackageName.Optimizer</code>.</p><p>The fields inside the optimizer are arbitrary. Store whatever is useful.</p><pre><code class="language-julia hljs">&quot;&quot;&quot;
    Optimizer()

Create a new optimizer for PDHG.
&quot;&quot;&quot;
mutable struct Optimizer &lt;: MOI.AbstractOptimizer
    # A mapping from variable to column
    x_to_col::Dict{MOI.VariableIndex,Int}
    # A mapping from constraint to rows
    ci_to_rows::Dict{
        MOI.ConstraintIndex{MOI.VectorAffineFunction{Float64},MOI.Zeros},
        Vector{Int},
    }
    # Information from solve_pdhg
    status::MOI.TerminationStatusCode
    iterations::Int
    x::Vector{Float64}
    y::Vector{Float64}
    # Other useful quantities
    solve_time::Float64
    obj_value::Float64

    function Optimizer()
        F = MOI.VectorAffineFunction{Float64}
        return new(
            Dict{MOI.VariableIndex,Int}(),
            Dict{MOI.ConstraintIndex{F,MOI.Zeros},Vector{Int}}(),
            MOI.OPTIMIZE_NOT_CALLED,
            0,
            Float64[],
            Float64[],
            0.0,
            0.0,
        )
    end
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Main.Optimizer</code></pre><p>Now that we have an <code>Optimizer</code>, we need to implement two methods: <a href="../../../moi/reference/models/#MathOptInterface.is_empty"><code>MOI.is_empty</code></a> and <a href="../../../moi/reference/models/#MathOptInterface.empty!"><code>MOI.empty!</code></a>. These are called whenever MOI needs to ensure that the optimizer is in a clean state.</p><pre><code class="language-julia hljs">function MOI.is_empty(model::Optimizer)
    # You might want to check every field, not just a few
    return isempty(model.x_to_col) &amp;&amp; model.status == MOI.OPTIMIZE_NOT_CALLED
end

function MOI.empty!(model::Optimizer)
    empty!(model.x_to_col)
    empty!(model.ci_to_rows)
    model.status = MOI.OPTIMIZE_NOT_CALLED
    model.iterations = 0
    model.solve_time = 0.0
    model.obj_value = 0.0
    empty!(model.x)
    empty!(model.y)
    return
end</code></pre><p>Next, we need to define what constraints the optimizer supports. Since our standard form was <span>$Ax = b$</span>, we support only <span>$Ax + b \in \{0\}$</span>, which is a <a href="../../../moi/reference/standard_form/#MathOptInterface.VectorAffineFunction"><code>MOI.VectorAffineFunction</code></a> in <a href="../../../moi/reference/standard_form/#MathOptInterface.Zeros"><code>MOI.Zeros</code></a> constraint. Note that you might have expected <span>$Ax - b \in \{0\}$</span>. We&#39;ll address the difference in the sign of <code>b</code> in a few places later on.</p><pre><code class="language-julia hljs">function MOI.supports_constraint(
    ::Optimizer,
    ::Type{MOI.VectorAffineFunction{Float64}},
    ::Type{MOI.Zeros},
)
    return true
end</code></pre><p>By default, MOI assumes that it can add free variables. This isn&#39;t true for our standard form, because we support only <span>$x \ge 0$</span>. Let&#39;s tell MOI that:</p><pre><code class="language-julia hljs">MOI.supports_add_constrained_variables(::Optimizer, ::Type{MOI.Reals}) = false

function MOI.supports_add_constrained_variables(
    ::Optimizer,
    ::Type{MOI.Nonnegatives},
)
    return true
end</code></pre><p>The objective function that we support is <a href="../../../moi/reference/standard_form/#MathOptInterface.ScalarAffineFunction"><code>MOI.ScalarAffineFunction</code></a>:</p><pre><code class="language-julia hljs">function MOI.supports(
    ::Optimizer,
    ::MOI.ObjectiveFunction{MOI.ScalarAffineFunction{Float64}},
)
    return true
end</code></pre><p>Finally, we&#39;ll implement <a href="../../../moi/reference/models/#MathOptInterface.SolverName"><code>MOI.SolverName</code></a> so that MOI knows how to print the name of our optimizer:</p><pre><code class="language-julia hljs">MOI.get(::Optimizer, ::MOI.SolverName) = &quot;PDHG&quot;</code></pre><h3 id="GenericModel"><a class="docs-heading-anchor" href="#GenericModel">GenericModel</a><a id="GenericModel-1"></a><a class="docs-heading-anchor-permalink" href="#GenericModel" title="Permalink"></a></h3><p>The simplest way to solve a problem with your optimizer is to implement the method <code>MOI.optimize!(dest::Optimizer, src::MOI.ModelLike)</code>, where <code>src</code> is an input model and <code>dest</code> is your empty optimizer.</p><p>To implement this method you would need to query the variables and constraints in <code>src</code> and the convert these into the matrix data expected by <code>solve_pdhg</code>. Since matrix input is a common requirement of solvers, MOI includes utilities to simplify the process.</p><p>The downside of the utilities is that they involve a highly parameterized type with a large number of possible configurations.The upside of the utilities is that, once setup, they requires few lines of code to extract the problem matrices.</p><p>First, we need to define the set of sets that our standard form supports. For PDHG, we support only <code>Ax + b in {0}</code>:</p><pre><code class="language-julia hljs">MOI.Utilities.@product_of_sets(SetOfZeros, MOI.Zeros)</code></pre><p>Then, we define a <a href="../../../moi/submodules/Utilities/reference/#MathOptInterface.Utilities.GenericModel"><code>MOI.Utilities.GenericModel</code></a>. This is the highly parameterized type that can be customized.</p><pre><code class="language-julia hljs">const CacheModel = MOI.Utilities.GenericModel{
    # The coefficient type is Float64
    Float64,
    # We use the default objective container
    MOI.Utilities.ObjectiveContainer{Float64},
    # We use the default variable container
    MOI.Utilities.VariablesContainer{Float64},
    # We use a Matrix of Constraints to represent `A * x + b in K`
    MOI.Utilities.MatrixOfConstraints{
        # The number type is Float64
        Float64,
        # The matrix type `A` is a sparse matrix
        MOI.Utilities.MutableSparseMatrixCSC{
            # ... with Float64 coefficients
            Float64,
            # ... Int64 row and column indices
            Int,
            # ... and it uses one-based indexing
            MOI.Utilities.OneBasedIndexing,
        },
        # The vector type `b` is a Julia `Vector`
        Vector{Float64},
        # The set type `K` is the SetOfZeros type we defined above
        SetOfZeros{Float64},
    },
}</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">MathOptInterface.Utilities.GenericModel{Float64, MathOptInterface.Utilities.ObjectiveContainer{Float64}, MathOptInterface.Utilities.VariablesContainer{Float64}, MathOptInterface.Utilities.MatrixOfConstraints{Float64, MathOptInterface.Utilities.MutableSparseMatrixCSC{Float64, Int64, MathOptInterface.Utilities.OneBasedIndexing}, Vector{Float64}, Main.SetOfZeros{Float64}}}</code></pre><p>As one example of possible alternate configuration, if you were interfacing with a solver written in C that expected zero-based indices, you might use instead:</p><pre><code class="language-julia hljs">MOI.Utilities.MutableSparseMatrixCSC{
    Cdouble,
    Cint,
    MOI.Utilities.ZeroBasedIndexing,
}</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">MathOptInterface.Utilities.MutableSparseMatrixCSC{Float64, Int32, MathOptInterface.Utilities.ZeroBasedIndexing}</code></pre><div class="admonition is-success"><header class="admonition-header">Tip</header><div class="admonition-body"><p>The best place to look at how to configure <code>GenericModel</code> is to find an existing solver with the same input standard form that you require.</p></div></div><p>We need to make one modification to <code>CacheModel</code> to tell MOI that <span>$x \in \mathbb{R}_+$</span> is equivalent to adding variables in <a href="../../../moi/reference/standard_form/#MathOptInterface.GreaterThan"><code>MOI.GreaterThan</code></a>:</p><pre><code class="language-julia hljs">function MOI.add_constrained_variables(model::CacheModel, set::MOI.Nonnegatives)
    x = MOI.add_variables(model, MOI.dimension(set))
    MOI.add_constraint.(model, x, MOI.GreaterThan(0.0))
    ci = MOI.ConstraintIndex{MOI.VectorOfVariables,MOI.Nonnegatives}(x[1].value)
    return x, ci
end</code></pre><h3 id="The-optimize-method"><a class="docs-heading-anchor" href="#The-optimize-method">The optimize method</a><a id="The-optimize-method-1"></a><a class="docs-heading-anchor-permalink" href="#The-optimize-method" title="Permalink"></a></h3><p>Now we define the most important method for our optimizer.</p><pre><code class="language-julia hljs">function MOI.optimize!(dest::Optimizer, src::MOI.ModelLike)
    # In addition to the values returned by `solve_pdhg`, it may be useful to
    # record other attributes, such as the solve time.
    start_time = time()
    # Construct a cache to store our problem data:
    cache = CacheModel()
    # MOI includes a utility to copy an arbitrary `src` model into `cache`. The
    # return, `index_map`, is a mapping from indices in `src` to indices in
    # `dest`.
    index_map = MOI.copy_to(cache, src)
    # Now we can access the `A` matrix:
    A = convert(
        SparseArrays.SparseMatrixCSC{Float64,Int},
        cache.constraints.coefficients,
    )
    # and the b vector (note that MOI models Ax = b as Ax + b in {0}, so b
    # differs by -):
    b = -cache.constraints.constants
    # The `c` vector is more involved, because we need to account for the
    # objective sense:
    sense = ifelse(cache.objective.sense == MOI.MAX_SENSE, -1, 1)
    F = MOI.ScalarAffineFunction{Float64}
    obj = MOI.get(src, MOI.ObjectiveFunction{F}())
    c = zeros(size(A, 2))
    for term in obj.terms
        c[term.variable.value] += sense * term.coefficient
    end
    # Now we can solve the problem with PDHG and record the solution:
    dest.status, dest.iterations, dest.x, dest.y = solve_pdhg(A, b, c)
    # To help assign the values of the x and y vectors to the appropriate
    # variables and constrats, we need a map of the constraint indices to their
    # row in the `dest` matrix and a map of the variable indices to their
    # column in the `dest` matrix:
    F, S = MOI.VectorAffineFunction{Float64}, MOI.Zeros
    for src_ci in MOI.get(src, MOI.ListOfConstraintIndices{F,S}())
        dest.ci_to_rows[index_map[src_ci]] =
            MOI.Utilities.rows(cache.constraints.sets, index_map[src_ci])
    end
    for (i, src_x) in enumerate(MOI.get(src, MOI.ListOfVariableIndices()))
        dest.x_to_col[index_map[src_x]] = i
    end
    # We can now record two derived quantities: the primal objective value and
    # the solve time.
    dest.obj_value = obj.constant + sense * c&#39; * dest.x
    dest.solve_time = time() - start_time
    # We need to return the index map, and `false`, to indicate to MOI that we
    # do not support incremental modification of the model.
    return index_map, false
end</code></pre><h2 id="Solutions"><a class="docs-heading-anchor" href="#Solutions">Solutions</a><a id="Solutions-1"></a><a class="docs-heading-anchor-permalink" href="#Solutions" title="Permalink"></a></h2><p>Now that we know how to solve a model, let&#39;s implement the required solution attributes.</p><p>First, we need to tell MOI how many solutions we found via <a href="../../../moi/reference/models/#MathOptInterface.ResultCount"><code>MOI.ResultCount</code></a>:</p><pre><code class="language-julia hljs">function MOI.get(model::Optimizer, ::MOI.ResultCount)
    return model.status == MOI.OPTIMAL ? 1 : 0
end</code></pre><p>and implement <a href="../../../moi/reference/models/#MathOptInterface.RawStatusString"><code>MOI.RawStatusString</code></a> to provide a user-readable string that describes what happened:</p><pre><code class="language-julia hljs">function MOI.get(model::Optimizer, ::MOI.RawStatusString)
    if model.status == MOI.OPTIMAL
        return &quot;found a primal-dual optimal solution (subject to tolerances)&quot;
    end
    return &quot;failed to solve&quot;
end</code></pre><p>Then, we need to implement the three types of problem status: <a href="../../../moi/reference/models/#MathOptInterface.TerminationStatus"><code>MOI.TerminationStatus</code></a>, <a href="../../../moi/reference/models/#MathOptInterface.PrimalStatus"><code>MOI.PrimalStatus</code></a> and <a href="../../../moi/reference/models/#MathOptInterface.DualStatus"><code>MOI.DualStatus</code></a>:</p><pre><code class="language-julia hljs">MOI.get(model::Optimizer, ::MOI.TerminationStatus) = model.status

function MOI.get(model::Optimizer, attr::Union{MOI.PrimalStatus,MOI.DualStatus})
    if attr.result_index == 1 &amp;&amp; model.status == MOI.OPTIMAL
        return MOI.FEASIBLE_POINT
    end
    return MOI.NO_SOLUTION
end</code></pre><p>Now we can implement <a href="../../../moi/reference/models/#MathOptInterface.ObjectiveValue"><code>MOI.ObjectiveValue</code></a>, <a href="../../../moi/reference/variables/#MathOptInterface.VariablePrimal"><code>MOI.VariablePrimal</code></a>, and <a href="../../../moi/reference/constraints/#MathOptInterface.ConstraintDual"><code>MOI.ConstraintDual</code></a>:</p><pre><code class="language-julia hljs">function MOI.get(model::Optimizer, attr::MOI.ObjectiveValue)
    MOI.check_result_index_bounds(model, attr)
    return model.obj_value
end

function MOI.get(
    model::Optimizer,
    attr::MOI.VariablePrimal,
    x::MOI.VariableIndex,
)
    MOI.check_result_index_bounds(model, attr)
    return model.x[model.x_to_col[x]]
end

function MOI.get(
    model::Optimizer,
    attr::MOI.ConstraintDual,
    ci::MOI.ConstraintIndex{MOI.VectorAffineFunction{Float64},MOI.Zeros},
)
    MOI.check_result_index_bounds(model, attr)
    # MOI models Ax = b as Ax + b in {0}, so the dual differs by -
    return -model.y[model.ci_to_rows[ci]]
end</code></pre><p>Some other useful result quantities are <a href="../../../moi/reference/models/#MathOptInterface.SolveTimeSec"><code>MOI.SolveTimeSec</code></a> and <a href="../../../moi/reference/models/#MathOptInterface.BarrierIterations"><code>MOI.BarrierIterations</code></a>:</p><pre><code class="language-julia hljs">MOI.get(model::Optimizer, ::MOI.SolveTimeSec) = model.solve_time
MOI.get(model::Optimizer, ::MOI.BarrierIterations) = model.iterations</code></pre><h2 id="A-JuMP-example"><a class="docs-heading-anchor" href="#A-JuMP-example">A JuMP example</a><a id="A-JuMP-example-1"></a><a class="docs-heading-anchor-permalink" href="#A-JuMP-example" title="Permalink"></a></h2><p>Now we can solve an arbitrary linear program with JuMP. Here&#39;s the same standard form as before:</p><pre><code class="language-julia hljs">model = Model(Optimizer)
@variable(model, x[1:5] &gt;= 0)
@objective(model, Min, c&#39; * x)
@constraint(model, c3, A * x == b)
optimize!(model)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">  iter      pobj          dobj         pfeas         dfeas       objfeas
  1000  2.050187e+02  2.044002e+02  2.006420e-01  2.674295e-02  6.185366e-01
  2000  2.049895e+02  2.051241e+02  1.705136e-02  2.746207e-02  1.346232e-01
  3000  2.050050e+02  2.050805e+02  8.907061e-03  8.405470e-03  7.550812e-02
  4000  2.050024e+02  2.049755e+02  4.046623e-03  9.374982e-04  2.689079e-02
  5000  2.049995e+02  2.049831e+02  8.635908e-04  6.483234e-04  1.633722e-02
  6000  2.049995e+02  2.050016e+02  7.833794e-04  1.676266e-04  2.095135e-03
  7000  2.050000e+02  2.050030e+02  2.811341e-05  3.065459e-04  2.964863e-03
  8000  2.050001e+02  2.050002e+02  1.316682e-04  1.674879e-05  8.453982e-05
  8365  2.049999e+02  2.050000e+02  9.473351e-05  2.381905e-06  7.955573e-05</code></pre><pre><code class="language-julia hljs">solution_summary(model; verbose = true)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">* Solver : PDHG

* Status
  Result count       : 1
  Termination status : OPTIMAL
  Message from the solver:
  &quot;found a primal-dual optimal solution (subject to tolerances)&quot;

* Candidate solution (result #1)
  Primal status      : FEASIBLE_POINT
  Dual status        : FEASIBLE_POINT
  Objective value    : 2.05000e+02
  Dual objective value : 2.05000e+02
  Primal solution :
    x[1] : 1.50001e+01
    x[2] : 1.24995e+00
    x[3] : 1.75010e+00
    x[4] : 0.00000e+00
    x[5] : 0.00000e+00
  Dual solution :
    c3 : [-1.93193e-06,2.50002e-01,1.50000e+00]

* Work counters
  Solve time (sec)   : 2.38002e-01
  Barrier iterations : 8365
</code></pre><p>But we could also have written:</p><pre><code class="language-julia hljs">model = Model(Optimizer)
@variable(model, x &gt;= 0)
@variable(model, 0 &lt;= y &lt;= 3)
@objective(model, Min, 12x + 20y)
@constraint(model, c1, 6x + 8y &gt;= 100)
@constraint(model, c2, 7x + 12y &gt;= 120)
optimize!(model)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">  iter      pobj          dobj         pfeas         dfeas       objfeas
  1000  2.050187e+02  2.044002e+02  2.006420e-01  2.674295e-02  6.185366e-01
  2000  2.049895e+02  2.051241e+02  1.705136e-02  2.746207e-02  1.346232e-01
  3000  2.050050e+02  2.050805e+02  8.907061e-03  8.405470e-03  7.550812e-02
  4000  2.050024e+02  2.049755e+02  4.046623e-03  9.374982e-04  2.689079e-02
  5000  2.049995e+02  2.049831e+02  8.635908e-04  6.483234e-04  1.633722e-02
  6000  2.049995e+02  2.050016e+02  7.833794e-04  1.676266e-04  2.095135e-03
  7000  2.050000e+02  2.050030e+02  2.811341e-05  3.065459e-04  2.964863e-03
  8000  2.050001e+02  2.050002e+02  1.316682e-04  1.674879e-05  8.453982e-05
  8365  2.049999e+02  2.050000e+02  9.473351e-05  2.381905e-06  7.955573e-05</code></pre><pre><code class="language-julia hljs">solution_summary(model; verbose = true)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">* Solver : PDHG

* Status
  Result count       : 1
  Termination status : OPTIMAL
  Message from the solver:
  &quot;found a primal-dual optimal solution (subject to tolerances)&quot;

* Candidate solution (result #1)
  Primal status      : FEASIBLE_POINT
  Dual status        : FEASIBLE_POINT
  Objective value    : 2.05000e+02
  Dual objective value : 2.05000e+02
  Primal solution :
    x : 1.50001e+01
    y : 1.24995e+00
  Dual solution :
    c1 : 2.50002e-01
    c2 : 1.50000e+00

* Work counters
  Solve time (sec)   : 1.86300e-03
  Barrier iterations : 8365
</code></pre><p>Other variations are also possible:</p><pre><code class="language-julia hljs">model = Model(Optimizer)
@variable(model, x[1:5] &gt;= 0)
@objective(model, Max, -c&#39; * x)
@constraint(model, c4, A * x .== b)
optimize!(model)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">  iter      pobj          dobj         pfeas         dfeas       objfeas
  1000  2.050187e+02  2.044002e+02  2.006420e-01  2.674295e-02  6.185366e-01
  2000  2.049895e+02  2.051241e+02  1.705136e-02  2.746207e-02  1.346232e-01
  3000  2.050050e+02  2.050805e+02  8.907061e-03  8.405470e-03  7.550812e-02
  4000  2.050024e+02  2.049755e+02  4.046623e-03  9.374982e-04  2.689079e-02
  5000  2.049995e+02  2.049831e+02  8.635908e-04  6.483234e-04  1.633722e-02
  6000  2.049995e+02  2.050016e+02  7.833794e-04  1.676266e-04  2.095135e-03
  7000  2.050000e+02  2.050030e+02  2.811341e-05  3.065459e-04  2.964863e-03
  8000  2.050001e+02  2.050002e+02  1.316682e-04  1.674879e-05  8.453982e-05
  8365  2.049999e+02  2.050000e+02  9.473351e-05  2.381905e-06  7.955573e-05</code></pre><pre><code class="language-julia hljs">solution_summary(model; verbose = true)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">* Solver : PDHG

* Status
  Result count       : 1
  Termination status : OPTIMAL
  Message from the solver:
  &quot;found a primal-dual optimal solution (subject to tolerances)&quot;

* Candidate solution (result #1)
  Primal status      : FEASIBLE_POINT
  Dual status        : FEASIBLE_POINT
  Objective value    : -2.05000e+02
  Dual objective value : -2.05000e+02
  Primal solution :
    x[1] : 1.50001e+01
    x[2] : 1.24995e+00
    x[3] : 1.75010e+00
    x[4] : 0.00000e+00
    x[5] : 0.00000e+00
  Dual solution :
    c4 : multiple constraints with the same name

* Work counters
  Solve time (sec)   : 1.85108e-03
  Barrier iterations : 8365
</code></pre><p>Behind the scenes, JuMP and MathOptInterface reformulate the problem from the modeller&#39;s form into the standard form defined by our <code>Optimizer</code>.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../parallelism/">« Parallelism</a><a class="docs-footer-nextpage" href="../../applications/power_systems/">Power Systems »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Tuesday 19 November 2024 21:47">Tuesday 19 November 2024</span>. Using Julia version 1.11.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
